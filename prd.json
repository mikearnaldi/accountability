{
  "project": "Accountability",
  "description": "Multi-company, multi-currency accounting application built on US GAAP principles",
  "version": "1.0.0",
  "created_at": "2026-01-10",
  "updated_at": "2026-01-10",
  "specifications_file": "SPECIFICATIONS.md",
  "technology": {
    "effect": {
      "version": "^3.19.0",
      "notes": "Schema is included in core effect package since 3.10.0. Import as: import * as Schema from 'effect/Schema'"
    },
    "effect_sql": {
      "packages": [
        "@effect/sql",
        "@effect/sql-pg",
        "@effect/sql-drizzle"
      ],
      "notes": "@effect/sql-pg requires @effect/experimental and @effect/platform as peer deps"
    },
    "effect_vitest": {
      "package": "@effect/vitest",
      "version": "^0.27.0",
      "peer_deps": [
        "vitest ^3.2.0"
      ]
    },
    "effect_platform": {
      "packages": [
        "@effect/platform",
        "@effect/platform-node"
      ],
      "notes": "Required for SQL and HTTP functionality"
    },
    "tanstack_start": {
      "package": "@tanstack/react-start",
      "version": "^1.147.0",
      "peer_deps": [
        "react ^19.0.0",
        "react-dom ^19.0.0",
        "vite ^7.0.0"
      ],
      "notes": "Use createServerFn for server functions. See repos/tanstack-router/examples/react/start-basic/"
    },
    "effect_atom": {
      "package": "@effect-rx/rx",
      "notes": "For reactive state management with Effect. See repos/effect-atom/"
    }
  },
  "reference_repos": {
    "effect": "repos/effect/packages/effect/src/",
    "effect_sql": "repos/effect/packages/sql/src/",
    "effect_sql_pg": "repos/effect/packages/sql-pg/src/",
    "effect_sql_drizzle": "repos/effect/packages/sql-drizzle/src/",
    "effect_vitest": "repos/effect/packages/vitest/src/",
    "tanstack_start": "repos/tanstack-router/packages/react-start/src/",
    "tanstack_examples": "repos/tanstack-router/examples/react/start-basic/"
  },
  "stories": [
    {
      "id": "1.1.1",
      "phase": "Foundation",
      "epic": "Project Setup",
      "title": "Initialize monorepo structure",
      "description": "Set up pnpm workspaces with packages for core, persistence, api, and web. Configure root package.json with workspace definitions. Reference repos/effect/pnpm-workspace.yaml for workspace structure.",
      "acceptance_criteria": [
        "pnpm-workspace.yaml exists with package paths",
        "Root package.json has workspace configuration",
        "packages/core, packages/persistence, packages/api, packages/web directories exist",
        "Each package has its own package.json with correct name (@accountability/core, etc.)"
      ],
      "priority": 1,
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.1.2",
      "phase": "Foundation",
      "epic": "Project Setup",
      "title": "Configure TypeScript with strict mode",
      "description": "Set up TypeScript configuration with strict mode enabled. Create base tsconfig.json and package-specific configs that extend it. Reference repos/effect/tsconfig.base.json for configuration patterns.",
      "acceptance_criteria": [
        "Root tsconfig.base.json with strict: true and modern settings",
        "Each package has tsconfig.json extending base",
        "TypeScript compiles without errors",
        "Path aliases configured for cross-package imports"
      ],
      "priority": 2,
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.1.3",
      "phase": "Foundation",
      "epic": "Project Setup",
      "title": "Set up Effect",
      "description": "Install Effect package in core. Schema is included in the core effect package since v3.10.0 - import as 'effect/Schema'. Reference repos/effect/packages/effect/src/Schema.ts for Schema API.",
      "acceptance_criteria": [
        "effect ^3.19.0 package installed in core",
        "Basic Effect program runs successfully using Effect.gen",
        "Schema validation works using import * as Schema from 'effect/Schema'",
        "Context and Layer patterns work for dependency injection"
      ],
      "priority": 3,
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.1.4",
      "phase": "Foundation",
      "epic": "Project Setup",
      "title": "Configure Vitest with Effect integration",
      "description": "Set up Vitest with @effect/vitest for testing Effect-based code. Reference repos/effect/packages/vitest/src/ for test patterns. Include coverage reporting.",
      "acceptance_criteria": [
        "vitest ^3.2.0 installed",
        "@effect/vitest ^0.27.0 installed for Effect test utilities",
        "Test command works in each package",
        "Coverage reporting enabled with v8 provider",
        "Example Effect test passes using @effect/vitest patterns"
      ],
      "priority": 4,
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.1.5",
      "phase": "Foundation",
      "epic": "Project Setup",
      "title": "Set up ESLint and Prettier",
      "description": "Configure ESLint with TypeScript support and Prettier for code formatting. Reference repos/effect/eslint.config.mjs for ESLint flat config patterns.",
      "acceptance_criteria": [
        "ESLint configured with flat config (eslint.config.mjs)",
        "TypeScript ESLint parser configured",
        "Prettier configured with consistent style",
        "Lint script runs without errors on initial codebase",
        "Format script properly formats code"
      ],
      "priority": 5,
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.2.1",
      "phase": "Foundation",
      "epic": "Core Value Objects",
      "title": "Implement MonetaryAmount value object",
      "description": "Create MonetaryAmount as a composite value object with decimal amount (high precision) and currency code. Use Schema from effect/Schema. Reference repos/effect/packages/effect/src/BigDecimal.ts for decimal handling.",
      "acceptance_criteria": [
        "MonetaryAmount schema using Schema.Struct with BigDecimal and CurrencyCode",
        "Use BigDecimal from effect/BigDecimal for precision",
        "Minimum 4 decimal places precision",
        "Validation rejects invalid currencies",
        "Arithmetic operations (add, subtract, multiply, divide) implemented using BigDecimal",
        "100% test coverage",
        "Do not accept any less than 100% test coverage, don't back off from tasks!",
        "Investigate deeply the issue of Equal not picking up"
      ],
      "priority": 6,
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.2.2",
      "phase": "Foundation",
      "epic": "Core Value Objects",
      "title": "Implement CurrencyCode value object",
      "description": "Create branded CurrencyCode type validated against ISO 4217 pattern (3 uppercase letters). Use Schema.String.pipe(Schema.pattern(), Schema.brand()). Reference repos/effect/packages/effect/src/Brand.ts.",
      "acceptance_criteria": [
        "CurrencyCode as Schema.String with pattern /^[A-Z]{3}$/ and brand",
        "Common currencies (USD, GBP, EUR, JPY) pass validation",
        "Invalid codes (lowercase, wrong length) rejected",
        "Type is branded for compile-time safety",
        "100% test coverage"
      ],
      "priority": 7,
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.2.3",
      "phase": "Foundation",
      "epic": "Core Value Objects",
      "title": "Implement AccountNumber value object",
      "description": "Create branded AccountNumber type following the numbering convention (1000-9999 ranges for different account types). Reference repos/effect/packages/effect/src/Schema.ts for filter and brand patterns.",
      "acceptance_criteria": [
        "AccountNumber branded type using Schema.String with validation",
        "Validation ensures 4-digit numeric format",
        "Helper function to determine AccountType from number range",
        "Ranges: 1xxx=Assets, 2xxx=Liabilities, 3xxx=Equity, 4xxx=Revenue, 5xxx-7xxx=Expenses",
        "100% test coverage"
      ],
      "priority": 8,
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.2.4",
      "phase": "Foundation",
      "epic": "Core Value Objects",
      "title": "Implement remaining core value objects",
      "description": "Implement JurisdictionCode (ISO 3166-1), Percentage (0-100), LocalDate, Timestamp, and FiscalPeriodRef value objects. Reference repos/effect/packages/effect/src/DateTime.ts for date handling.",
      "acceptance_criteria": [
        "JurisdictionCode with ISO 3166-1 alpha-2 validation (/^[A-Z]{2}$/)",
        "Percentage as Schema.Number with filter for 0-100 range, supports decimals",
        "LocalDate using Schema wrapper around effect/DateTime",
        "Timestamp for UTC timestamps using DateTime.Utc",
        "FiscalPeriodRef as Schema.Struct with year (number) and period (1-13)",
        "100% test coverage for all",
        "Use TestClock to test the nowEffect"
      ],
      "priority": 9,
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.2.5",
      "phase": "Foundation",
      "epic": "Core Value Objects",
      "title": "Align all value objects to Schema constructor standards",
      "description": "Revise all value objects created in 1.2.x to follow Effect Schema best practices: use Schema.Class instead of Schema.Struct where appropriate, remove redundant make/create functions (Schema provides .make() automatically), use flat module structure without barrel files, ensure all branded types use the Schema-provided .make() constructor.",
      "acceptance_criteria": [
        "All domain entities use Schema.Class instead of Schema.Struct",
        "Remove all custom make/create functions - use MyClass.make() or BrandedType.make() from Schema",
        "Flatten module structure - no index.ts barrel files, each type in its own file at src/ level",
        "Ensure Equal and Hash are auto-derived (no manual implementations)",
        "All tests pass after refactoring",
        "Type guards use Schema.is(MySchema) not custom implementations",
        "Value equality in Schema.Class compares fields via Equals, so you don't need a custom equality to handle BigDecimal",
        "Don't create dumb renamed function for tests like mkTs use proper constructors directly",
        "Remove the bd() utility use the BigDecimal.unsafeFromString in tests"
      ],
      "priority": 10,
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.3.1",
      "phase": "Foundation",
      "epic": "Core Entities",
      "title": "Implement Organization entity",
      "description": "Create Organization entity as the top-level container for companies with reporting currency and settings. Use Schema.Class or Schema.Struct pattern. Reference repos/effect/packages/effect/src/Schema.ts for Class patterns.",
      "acceptance_criteria": [
        "Organization schema with id, name, reportingCurrency, createdAt, settings",
        "OrganizationId as branded UUID string",
        "Use Schema.Struct or Schema.Class pattern",
        "Validation for required fields",
        "100% test coverage"
      ],
      "priority": 10,
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.3.2",
      "phase": "Foundation",
      "epic": "Core Entities",
      "title": "Implement Company entity",
      "description": "Create Company entity with functional currency, jurisdiction, fiscal settings, and consolidation properties. Reference SPECIFICATIONS.md for full property list.",
      "acceptance_criteria": [
        "Company schema with all properties from spec",
        "CompanyId branded type (UUID)",
        "Functional and reporting currency as CurrencyCode",
        "Parent company reference as optional CompanyId",
        "Ownership percentage using Percentage value object",
        "ConsolidationMethod enum: FullConsolidation, EquityMethod, CostMethod, VariableInterestEntity",
        "100% test coverage"
      ],
      "priority": 11,
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.3.3",
      "phase": "Foundation",
      "epic": "Core Entities",
      "title": "Implement Currency entity",
      "description": "Create Currency entity with ISO code, name, symbol, decimal places, and active status.",
      "acceptance_criteria": [
        "Currency schema with code (CurrencyCode), name, symbol, decimalPlaces, isActive",
        "Decimal places as Schema.Literal(0, 2, 3, 4)",
        "Predefined common currencies (USD, EUR, GBP, JPY, etc.)",
        "100% test coverage"
      ],
      "priority": 12,
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.3.4",
      "phase": "Foundation",
      "epic": "Core Entities",
      "title": "Implement ExchangeRate entity",
      "description": "Create ExchangeRate entity with from/to currencies, rate, effective date, rate type, and source.",
      "acceptance_criteria": [
        "ExchangeRate schema with all properties",
        "ExchangeRateId branded type",
        "RateType as Schema.Literal: 'Spot', 'Average', 'Historical', 'Closing'",
        "RateSource as Schema.Literal: 'Manual', 'Import', 'API'",
        "Rate as positive BigDecimal",
        "100% test coverage"
      ],
      "priority": 13,
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.3.5",
      "phase": "Foundation",
      "epic": "Core Entities",
      "title": "Implement Jurisdiction entity",
      "description": "Create Jurisdiction entity with country code, name, default currency, and tax settings.",
      "acceptance_criteria": [
        "Jurisdiction schema with code (JurisdictionCode), name, defaultCurrency, taxSettings",
        "TaxSettings as Schema.Struct with configurable tax rules",
        "Predefined jurisdictions for US and GB",
        "100% test coverage"
      ],
      "priority": 14,
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.4.1",
      "phase": "Foundation",
      "epic": "Chart of Accounts",
      "title": "Implement Account entity",
      "description": "Create Account entity with full classification including type, category, normal balance, hierarchy, and behavior properties. This is a complex entity - reference SPECIFICATIONS.md for all properties.",
      "acceptance_criteria": [
        "Account schema with all properties from spec",
        "AccountId branded type",
        "AccountType as Schema.Literal: 'Asset', 'Liability', 'Equity', 'Revenue', 'Expense'",
        "AccountCategory enum with all subcategories per type",
        "NormalBalance as Schema.Literal: 'Debit', 'Credit'",
        "CashFlowCategory as Schema.Literal: 'Operating', 'Investing', 'Financing', 'NonCash'",
        "Parent account reference as optional AccountId for hierarchy",
        "Intercompany properties: isIntercompany flag, intercompanyPartnerId",
        "100% test coverage"
      ],
      "priority": 15,
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "1.4.2",
      "phase": "Foundation",
      "epic": "Chart of Accounts",
      "title": "Implement account hierarchy logic",
      "description": "Create pure functions to manage account hierarchy - building trees, calculating rollups, and validating parent-child relationships. Use effect/Array utilities.",
      "acceptance_criteria": [
        "Function buildAccountTree: Account[] -> AccountNode[] (tree structure)",
        "Function getDescendants: (accounts: Account[], accountId: AccountId) -> Account[]",
        "Function getAncestors: (accounts: Account[], accountId: AccountId) -> Account[]",
        "Validation that child account type matches parent type",
        "100% test coverage with property-based tests",
        "Use FastCheck from the effect re-export",
        "Use Schema to define custom classes",
        "Use Schema.Chunk not Schema.ChunkFromSelf so that it is serializeable"
      ],
      "priority": 16,
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.4.3",
      "phase": "Foundation",
      "epic": "Chart of Accounts",
      "title": "Implement account validation rules",
      "description": "Create validation functions for accounts including number range checks, category consistency, and intercompany configuration. Return typed errors.",
      "acceptance_criteria": [
        "Validate account number is in correct range for type (1xxx=Assets, etc.)",
        "Validate normal balance is correct for account type (Assets=Debit, etc.)",
        "Validate intercompany accounts have partner company set",
        "Validate cash flow category only set for balance sheet accounts",
        "Return Schema.TaggedError for validation failures",
        "100% test coverage",
        "Don't use *FromSelf we want everything to be serializeable"
      ],
      "priority": 17,
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.4.4",
      "phase": "Foundation",
      "epic": "Chart of Accounts",
      "title": "Create standard account templates",
      "description": "Create predefined account templates for General Business, Manufacturing, Service Business, and Holding Company. Templates are pure data structures.",
      "acceptance_criteria": [
        "GeneralBusinessTemplate with ~50 standard accounts covering all types",
        "ManufacturingTemplate extending general with inventory and COGS detail accounts",
        "ServiceBusinessTemplate with service revenue focus",
        "HoldingCompanyTemplate with investment and intercompany accounts",
        "Function instantiateTemplate: (template, companyId) -> Account[]",
        "100% test coverage"
      ],
      "priority": 18,
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.5.1",
      "phase": "Foundation",
      "epic": "Journal Entries",
      "title": "Implement JournalEntry entity",
      "description": "Create JournalEntry entity with header properties including dates, period, type, status, and audit information. Reference SPECIFICATIONS.md for complete property list.",
      "acceptance_criteria": [
        "JournalEntry schema with all header properties",
        "JournalEntryId branded type (UUID)",
        "EntryNumber as branded string for sequential numbering",
        "JournalEntryType as Schema.Literal with all types from spec",
        "JournalEntryStatus as Schema.Literal: 'Draft', 'PendingApproval', 'Approved', 'Posted', 'Reversed'",
        "SourceModule as Schema.Literal for originating module",
        "Reversal tracking: isReversing, reversedEntryId, reversingEntryId",
        "Audit fields: createdBy, createdAt, postedBy, postedAt",
        "100% test coverage"
      ],
      "priority": 19,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "1.5.2",
      "phase": "Foundation",
      "epic": "Journal Entries",
      "title": "Implement JournalEntryLine entity",
      "description": "Create JournalEntryLine entity with account, amounts in transaction and functional currencies, and intercompany properties.",
      "acceptance_criteria": [
        "JournalEntryLine schema with all properties",
        "JournalEntryLineId branded type",
        "Schema.filter to ensure exactly one of debit/credit is set (not both, not neither)",
        "Transaction currency amounts as MonetaryAmount",
        "Functional currency amounts with exchangeRate as BigDecimal",
        "Optional memo as Schema.String",
        "Optional dimensions as Record<string, string> for reporting",
        "Intercompany: partnerId and matchingLineId as optional",
        "100% test coverage"
      ],
      "priority": 20,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.5.3",
      "phase": "Foundation",
      "epic": "Journal Entries",
      "title": "Implement balance validation",
      "description": "Create the fundamental validation that total debits equal total credits for a journal entry. Use BigDecimal for precision.",
      "acceptance_criteria": [
        "Function sumDebits: JournalEntryLine[] -> BigDecimal",
        "Function sumCredits: JournalEntryLine[] -> BigDecimal",
        "Function validateBalance: JournalEntry -> Effect<void, UnbalancedEntryError>",
        "Support for multi-currency entries (compare in functional currency)",
        "UnbalancedEntryError extends Schema.TaggedError with debit/credit totals",
        "Property-based test: all valid entries have equal debits and credits",
        "100% test coverage"
      ],
      "priority": 21,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.5.4",
      "phase": "Foundation",
      "epic": "Journal Entries",
      "title": "Implement multi-currency line handling",
      "description": "Create logic for handling journal entry lines in different currencies, converting to functional currency.",
      "acceptance_criteria": [
        "Function convertToFunctional: (amount: MonetaryAmount, rate: BigDecimal, functionalCurrency: CurrencyCode) -> MonetaryAmount",
        "Validation that exchange rate is provided when transaction currency differs from functional",
        "Calculation stores both original and functional amounts on line",
        "MissingExchangeRateError for missing rates",
        "100% test coverage"
      ],
      "priority": 22,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.5.5",
      "phase": "Foundation",
      "epic": "Journal Entries",
      "title": "Implement entry status workflow",
      "description": "Create state machine for journal entry status transitions with validation of allowed transitions. Use Match from effect for pattern matching.",
      "acceptance_criteria": [
        "Status transition rules as pure data structure",
        "Draft -> PendingApproval: allowed",
        "PendingApproval -> Approved: allowed",
        "PendingApproval -> Draft: allowed (rejection)",
        "Approved -> Posted: allowed",
        "Posted -> Reversed: only via separate reversal entry creation",
        "InvalidStatusTransitionError for disallowed transitions",
        "Function canTransition: (from: Status, to: Status) -> boolean",
        "100% test coverage"
      ],
      "priority": 23,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "2.1.1",
      "phase": "Core Services",
      "epic": "Journal Entry Service",
      "title": "Implement journal entry creation service",
      "description": "Create Effect service for creating new journal entries with full validation. Use Context.Tag and Layer patterns. Reference repos/effect/packages/effect/src/Context.ts.",
      "acceptance_criteria": [
        "JournalEntryService defined with Context.Tag pattern",
        "create operation returns Effect<JournalEntry, JournalEntryError, Dependencies>",
        "Validates balance before creation",
        "Validates all accounts exist and are postable via AccountRepository",
        "Validates period is open via PeriodRepository",
        "Assigns sequential entry number",
        "JournalEntryError as union of specific error types",
        "JournalEntryServiceLive as Layer implementation",
        "100% test coverage with mocked dependencies"
      ],
      "priority": 24,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "2.1.2",
      "phase": "Core Services",
      "epic": "Journal Entry Service",
      "title": "Implement journal entry posting",
      "description": "Create service operation to post an approved journal entry to the general ledger.",
      "acceptance_criteria": [
        "post operation in JournalEntryService",
        "Validates entry is in 'Approved' status",
        "Validates period is still open",
        "Updates status to 'Posted'",
        "Records postedBy (UserId) and postedAt (Timestamp)",
        "Returns typed errors: NotApprovedError, PeriodClosedError",
        "100% test coverage"
      ],
      "priority": 25,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "2.1.3",
      "phase": "Core Services",
      "epic": "Journal Entry Service",
      "title": "Implement journal entry reversal",
      "description": "Create service operation to reverse a posted journal entry by creating a reversing entry.",
      "acceptance_criteria": [
        "reverse operation in JournalEntryService",
        "Creates new entry with opposite debits/credits (swap debit<->credit on each line)",
        "New entry has isReversing=true and reversedEntryId set",
        "Updates original entry with reversingEntryId",
        "Updates original entry status to 'Reversed'",
        "Reversal entry is created as Posted (bypasses approval)",
        "100% test coverage"
      ],
      "priority": 26,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "2.2.1",
      "phase": "Core Services",
      "epic": "Currency Service",
      "title": "Implement exchange rate management",
      "description": "Create CurrencyService for managing exchange rates including CRUD operations and rate lookups.",
      "acceptance_criteria": [
        "CurrencyService with Context.Tag pattern",
        "createRate, updateRate operations",
        "getRate: (from, to, date, type) -> Effect<ExchangeRate, RateNotFoundError>",
        "getLatestRate: (from, to) -> Effect<ExchangeRate, RateNotFoundError>",
        "Depends on ExchangeRateRepository",
        "100% test coverage"
      ],
      "priority": 27,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "2.2.2",
      "phase": "Core Services",
      "epic": "Currency Service",
      "title": "Implement currency translation",
      "description": "Create service operation for translating amounts between currencies using appropriate rates.",
      "acceptance_criteria": [
        "translate: (amount, toCurrency, date, rateType) -> Effect<TranslationResult>",
        "TranslationResult includes: originalAmount, translatedAmount, rateUsed, rateDate",
        "Support Spot, Average, Historical, Closing rate types",
        "Handle currency pairs in either direction (USD->EUR and EUR->USD)",
        "Inverse rate calculation when direct rate not available",
        "100% test coverage"
      ],
      "priority": 28,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "2.2.3",
      "phase": "Core Services",
      "epic": "Currency Service",
      "title": "Implement period-end revaluation",
      "description": "Create service operation for revaluing foreign currency monetary items at period end per ASC 830.",
      "acceptance_criteria": [
        "revalue: (companyId, periodId, closingDate) -> Effect<RevaluationResult>",
        "Identify monetary accounts (cash, receivables, payables) with foreign currency balances",
        "Calculate unrealized gain/loss using closing rate vs. book rate",
        "Generate revaluation journal entry automatically",
        "RevaluationResult with per-account detail and total gain/loss",
        "100% test coverage"
      ],
      "priority": 29,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "2.3.1",
      "phase": "Core Services",
      "epic": "Period Management",
      "title": "Implement fiscal year and period creation",
      "description": "Create PeriodService for creating fiscal years with periods based on company fiscal settings.",
      "acceptance_criteria": [
        "PeriodService with Context.Tag pattern",
        "createFiscalYear: (companyId, startDate) -> Effect<FiscalYear>",
        "Auto-generate 12 monthly periods based on company's fiscal year settings",
        "Support for period 13 (adjustment period) as optional",
        "Validate year doesn't overlap existing years for company",
        "100% test coverage"
      ],
      "priority": 30,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "2.3.2",
      "phase": "Core Services",
      "epic": "Period Management",
      "title": "Implement period open/close logic",
      "description": "Create service operations for opening and closing fiscal periods with proper validations.",
      "acceptance_criteria": [
        "openPeriod: (periodId) -> Effect<FiscalPeriod, PeriodError>",
        "closePeriod: (periodId) -> Effect<FiscalPeriod, PeriodError>",
        "softClosePeriod for limited posting (requires approval)",
        "Validate no Draft entries exist before close",
        "reopenPeriod with audit trail (requires reason)",
        "PeriodError union: HasDraftEntriesError, AlreadyClosedError, etc.",
        "100% test coverage"
      ],
      "priority": 31,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "2.3.3",
      "phase": "Core Services",
      "epic": "Period Management",
      "title": "Implement year-end close process",
      "description": "Create service for year-end closing including closing entries to retained earnings.",
      "acceptance_criteria": [
        "closeYear: (fiscalYearId, retainedEarningsAccountId) -> Effect<YearEndResult>",
        "Generate closing entries for all income accounts (credit to RE)",
        "Generate closing entries for all expense accounts (debit to RE)",
        "Net income = total revenue credits - total expense debits",
        "Generate opening balances for new year (balance sheet accounts)",
        "Support year reopen: creates reversing entries for closing entries",
        "100% test coverage"
      ],
      "priority": 32,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "3.1.1",
      "phase": "Reporting Engine",
      "epic": "Trial Balance",
      "title": "Implement account balance calculation",
      "description": "Create pure functions to calculate account balances from posted journal entries. Use BigDecimal for all calculations.",
      "acceptance_criteria": [
        "calculateBalance: (accountId, entries, asOfDate) -> BigDecimal",
        "calculatePeriodBalance: (accountId, entries, periodStart, periodEnd) -> BigDecimal",
        "calculateYTDBalance: (accountId, entries, fiscalYearStart, asOfDate) -> BigDecimal",
        "calculateBeginningBalance: (accountId, entries, periodStart) -> BigDecimal",
        "Handle debit/credit normal balances correctly (debits increase assets, credits increase liabilities)",
        "All functions are pure - no side effects",
        "100% test coverage with property-based tests"
      ],
      "priority": 33,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "3.1.2",
      "phase": "Reporting Engine",
      "epic": "Trial Balance",
      "title": "Implement trial balance report",
      "description": "Create trial balance report showing all account balances with debit/credit columns.",
      "acceptance_criteria": [
        "TrialBalanceReport schema with metadata and line items",
        "generateTrialBalance: (companyId, asOfDate) -> Effect<TrialBalanceReport>",
        "Shows all accounts with non-zero balances",
        "Debit and credit columns (not net balance)",
        "Total debits equals total credits (validation)",
        "Support for filtering by date range",
        "100% test coverage"
      ],
      "priority": 34,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "3.2.1",
      "phase": "Reporting Engine",
      "epic": "Balance Sheet",
      "title": "Implement balance sheet report",
      "description": "Create balance sheet report with current/non-current classification per ASC 210.",
      "acceptance_criteria": [
        "BalanceSheetReport schema with sections and line items",
        "generateBalanceSheet: (companyId, asOfDate, options) -> Effect<BalanceSheetReport>",
        "Sections: Current Assets, Non-Current Assets, Current Liabilities, Non-Current Liabilities, Equity",
        "Line items grouped by AccountCategory",
        "Subtotals for each section",
        "Validation: Total Assets = Total Liabilities + Total Equity",
        "Support for comparative periods (prior year/period)",
        "100% test coverage"
      ],
      "priority": 35,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "3.3.1",
      "phase": "Reporting Engine",
      "epic": "Income Statement",
      "title": "Implement income statement report",
      "description": "Create income statement report with multi-step format and expenses by function per ASC 220.",
      "acceptance_criteria": [
        "IncomeStatementReport schema with sections",
        "generateIncomeStatement: (companyId, periodStart, periodEnd, options) -> Effect<IncomeStatementReport>",
        "Multi-step format: Revenue -> COGS -> Gross Profit -> OpEx -> Operating Income -> Other -> Net Income",
        "Expenses grouped by function (per US GAAP requirement)",
        "Subtotals: Gross Profit, Operating Income, Income Before Tax, Net Income",
        "Support for comparative periods",
        "100% test coverage"
      ],
      "priority": 36,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "3.4.1",
      "phase": "Reporting Engine",
      "epic": "Cash Flow Statement",
      "title": "Implement cash flow statement - indirect method",
      "description": "Create cash flow statement using indirect method per ASC 230. This is complex - requires analyzing account changes.",
      "acceptance_criteria": [
        "CashFlowStatementReport schema",
        "generateCashFlowStatement: (companyId, periodStart, periodEnd) -> Effect<CashFlowStatementReport>",
        "Operating: Start with Net Income, adjust for non-cash items and working capital changes",
        "Investing: Capital expenditures, asset sales, investment activity",
        "Financing: Debt, equity, dividends",
        "Net change in cash reconciles to balance sheet cash movement",
        "Supplemental disclosures: Interest paid, Taxes paid",
        "100% test coverage"
      ],
      "priority": 37,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "3.5.1",
      "phase": "Reporting Engine",
      "epic": "Statement of Equity",
      "title": "Implement statement of changes in equity",
      "description": "Create statement of changes in equity showing movements in each equity component.",
      "acceptance_criteria": [
        "EquityStatementReport schema with component columns and movement rows",
        "generateEquityStatement: (companyId, periodStart, periodEnd) -> Effect<EquityStatementReport>",
        "Columns: Common Stock, APIC, Retained Earnings, Treasury Stock, AOCI, NCI (if consolidated)",
        "Rows: Opening Balance, Net Income, OCI, Dividends, Stock Issuance/Repurchase, Closing Balance",
        "Column totals and row totals",
        "100% test coverage"
      ],
      "priority": 38,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "4.1.1",
      "phase": "Consolidation",
      "epic": "Consolidation Structure",
      "title": "Implement consolidation group entity",
      "description": "Create ConsolidationGroup entity with parent company, members, and elimination rules.",
      "acceptance_criteria": [
        "ConsolidationGroup schema with all properties from spec",
        "ConsolidationGroupId branded type",
        "Members as array of ConsolidationMember (companyId, ownershipPct, method, acquisitionDate)",
        "EliminationRules as array of rule references",
        "Reporting currency for consolidated statements",
        "100% test coverage"
      ],
      "priority": 39,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "4.1.2",
      "phase": "Consolidation",
      "epic": "Consolidation Structure",
      "title": "Implement consolidation method determination",
      "description": "Create logic to determine consolidation method based on ownership and VIE status per ASC 810.",
      "acceptance_criteria": [
        "determineMethod: (ownershipPct, isVIEPrimaryBeneficiary) -> ConsolidationMethod",
        ">50% ownership -> FullConsolidation",
        "20-50% ownership -> EquityMethod",
        "<20% ownership -> CostMethod",
        "VIE primary beneficiary -> FullConsolidation regardless of ownership",
        "Pure function with comprehensive test cases",
        "100% test coverage"
      ],
      "priority": 40,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "4.2.1",
      "phase": "Consolidation",
      "epic": "Intercompany Management",
      "title": "Implement intercompany transaction tracking",
      "description": "Create IntercompanyTransaction entity and matching logic for reconciliation.",
      "acceptance_criteria": [
        "IntercompanyTransaction schema from spec",
        "IntercompanyTransactionType enum: SalePurchase, Loan, ManagementFee, Dividend, etc.",
        "MatchingStatus enum: Matched, Unmatched, PartiallyMatched, VarianceApproved",
        "Links to journal entries on both sides",
        "Variance amount and explanation fields",
        "100% test coverage"
      ],
      "priority": 41,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "4.2.2",
      "phase": "Consolidation",
      "epic": "Intercompany Management",
      "title": "Implement intercompany matching service",
      "description": "Create service to match intercompany transactions between companies and identify discrepancies.",
      "acceptance_criteria": [
        "IntercompanyService with Context.Tag pattern",
        "matchTransactions: (groupId, periodId) -> Effect<MatchingResult>",
        "Match by: transaction type, date (within tolerance), amount, partner company",
        "Identify unmatched transactions on each side",
        "Calculate variances for partial matches",
        "Generate matching report with discrepancy details",
        "100% test coverage"
      ],
      "priority": 42,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "4.3.1",
      "phase": "Consolidation",
      "epic": "Elimination Engine",
      "title": "Implement elimination rule entity",
      "description": "Create EliminationRule entity with trigger conditions and account mappings.",
      "acceptance_criteria": [
        "EliminationRule schema with all properties from spec",
        "EliminationType enum from spec",
        "AccountSelector: byId, byRange, byCategory",
        "Debit and credit account targets for elimination entry",
        "isAutomatic flag for auto-processing",
        "Priority for ordering",
        "100% test coverage"
      ],
      "priority": 43,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "4.3.2",
      "phase": "Consolidation",
      "epic": "Elimination Engine",
      "title": "Implement automatic elimination generation",
      "description": "Create service to automatically generate elimination entries based on rules.",
      "acceptance_criteria": [
        "EliminationService with Context.Tag pattern",
        "generateEliminations: (groupId, periodId, rules) -> Effect<EliminationEntry[]>",
        "Process rules in priority order",
        "Generate journal entries for each elimination",
        "Types: IC AR/AP, IC Revenue/Expense, IC Dividend, Investment vs Equity, Unrealized profit",
        "Each elimination entry links to the rule that generated it",
        "100% test coverage"
      ],
      "priority": 44,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "4.4.1",
      "phase": "Consolidation",
      "epic": "Consolidation Run",
      "title": "Implement consolidation run orchestration",
      "description": "Create ConsolidationRun entity and service to orchestrate the full consolidation process.",
      "acceptance_criteria": [
        "ConsolidationRun schema with status and steps from spec",
        "ConsolidationService.run: (groupId, periodId, options) -> Effect<ConsolidationRun>",
        "Execute steps in order: Validate -> Translate -> Aggregate -> Match IC -> Eliminate -> NCI -> Generate TB",
        "Track progress, timing, and status of each step",
        "Handle step failures gracefully (mark run as Failed, store error)",
        "Store resulting consolidated trial balance",
        "100% test coverage"
      ],
      "priority": 45,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "4.4.2",
      "phase": "Consolidation",
      "epic": "Consolidation Run",
      "title": "Implement currency translation for consolidation",
      "description": "Create translation step that translates all member balances to reporting currency per ASC 830.",
      "acceptance_criteria": [
        "translateMemberBalances: (member, reportingCurrency, rates) -> Effect<TranslatedTrialBalance>",
        "Assets/Liabilities: Closing rate",
        "Income/Expense: Average rate (or transaction date rate)",
        "Equity (capital accounts): Historical rate",
        "Retained Earnings: Calculated (opening + NI - dividends)",
        "Calculate CTA (Cumulative Translation Adjustment) as plug to OCI",
        "100% test coverage"
      ],
      "priority": 46,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "4.4.3",
      "phase": "Consolidation",
      "epic": "Consolidation Run",
      "title": "Implement minority interest calculation",
      "description": "Create calculation for non-controlling interest share of subsidiary equity and income.",
      "acceptance_criteria": [
        "calculateNCI: (subsidiary, ownershipPct) -> NCIResult",
        "NCI % = 100% - parent ownership %",
        "NCI share of subsidiary equity (at acquisition + subsequent changes)",
        "NCI share of subsidiary net income for period",
        "Separate NCI line items in consolidated statements",
        "100% test coverage"
      ],
      "priority": 47,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "5.1.1",
      "phase": "Persistence",
      "epic": "Repository Interfaces",
      "title": "Define repository interfaces",
      "description": "Create Effect-based repository interfaces for all core entities. Use Context.Tag pattern. Reference repos/effect/packages/sql/src/ for patterns.",
      "acceptance_criteria": [
        "Repository interfaces using Context.Tag pattern",
        "CompanyRepository: findById, findByOrg, create, update",
        "AccountRepository: findById, findByCompany, create, update, findByNumber",
        "JournalEntryRepository: findById, findByCompany, findByPeriod, create, update",
        "ExchangeRateRepository: findRate, findLatestRate, create",
        "FiscalPeriodRepository: findById, findByCompany, findOpen, create, update",
        "ConsolidationRepository: findGroup, findRun, createRun, updateRun",
        "All operations return Effect with typed errors"
      ],
      "priority": 48,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "5.2.1",
      "phase": "Persistence",
      "epic": "Database Schema",
      "title": "Create PostgreSQL schema with Drizzle",
      "description": "Create database schema using Drizzle ORM for all entities with proper relationships and indexes. Reference repos/effect/packages/sql-drizzle/.",
      "acceptance_criteria": [
        "Drizzle schema definitions for all entities",
        "Proper column types (uuid, text, numeric for BigDecimal, timestamptz)",
        "Foreign key relationships with proper cascades",
        "Indexes on: foreign keys, commonly queried fields (companyId, periodId, status)",
        "Audit columns: createdAt, updatedAt (with triggers or app-level)",
        "Soft delete support: deletedAt column where needed",
        "Migration files generated from schema"
      ],
      "priority": 49,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "5.3.1",
      "phase": "Persistence",
      "epic": "Repository Implementations",
      "title": "Implement repositories with Effect SQL",
      "description": "Implement all repository interfaces using @effect/sql and @effect/sql-drizzle for PostgreSQL. Reference repos/effect/packages/sql-drizzle/src/.",
      "acceptance_criteria": [
        "@effect/sql and @effect/sql-drizzle configured",
        "@effect/sql-pg for PostgreSQL connection",
        "All repository interfaces implemented as Layers",
        "Proper error handling: wrap DB errors in domain errors",
        "Transaction support via SqlClient.transaction",
        "Integration tests against test database",
        "Connection pooling configured"
      ],
      "priority": 50,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "6.1.1",
      "phase": "API Layer",
      "epic": "TanStack Start Setup",
      "title": "Initialize TanStack Start project",
      "description": "Set up TanStack Start in the web package with proper configuration. Reference repos/tanstack-router/examples/react/start-basic/ for patterns.",
      "acceptance_criteria": [
        "@tanstack/react-start ^1.147.0 installed",
        "@tanstack/react-router for routing",
        "vite ^7.0.0 configured",
        "React 19 configured",
        "Basic route structure: / (home), /companies, /journal-entries, /reports",
        "Server functions pattern working (createServerFn)",
        "Dev server runs successfully with pnpm dev"
      ],
      "priority": 51,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.2.1",
      "phase": "API Layer",
      "epic": "Server Functions",
      "title": "Implement company management server functions",
      "description": "Create server functions for company CRUD operations using createServerFn pattern.",
      "acceptance_criteria": [
        "createCompany server function with Schema validation",
        "getCompany server function",
        "updateCompany server function",
        "listCompanies server function with pagination",
        "Proper error handling returning typed errors",
        "Effect services integrated via Runtime"
      ],
      "priority": 52,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.2.2",
      "phase": "API Layer",
      "epic": "Server Functions",
      "title": "Implement journal entry server functions",
      "description": "Create server functions for journal entry operations.",
      "acceptance_criteria": [
        "createJournalEntry server function",
        "postJournalEntry server function",
        "reverseJournalEntry server function",
        "listJournalEntries server function with filters (company, period, status)",
        "getJournalEntry server function with lines"
      ],
      "priority": 53,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.2.3",
      "phase": "API Layer",
      "epic": "Server Functions",
      "title": "Implement reporting server functions",
      "description": "Create server functions for report generation.",
      "acceptance_criteria": [
        "generateTrialBalance server function",
        "generateBalanceSheet server function",
        "generateIncomeStatement server function",
        "generateCashFlowStatement server function",
        "Report parameters: companyId, asOfDate/period, comparative options",
        "Returns report data structure (JSON for now)"
      ],
      "priority": 54,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "7.1.1",
      "phase": "UI Layer",
      "epic": "Core Components",
      "title": "Implement account selector component",
      "description": "Create reusable account selector/picker component with search and hierarchy display.",
      "acceptance_criteria": [
        "Searchable dropdown using React state",
        "Shows account hierarchy with indentation",
        "Filters by account type if prop provided",
        "Keyboard navigation (arrow keys, enter, escape)",
        "Accessible: proper ARIA attributes",
        "Controlled component with value/onChange props"
      ],
      "priority": 55,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "7.1.2",
      "phase": "UI Layer",
      "epic": "Core Components",
      "title": "Implement currency input component",
      "description": "Create currency input component with proper formatting and decimal handling.",
      "acceptance_criteria": [
        "Currency symbol display (prefix or suffix based on locale)",
        "Proper decimal formatting (2-4 places based on currency)",
        "Thousand separators",
        "Negative number support with proper display",
        "Optional currency code selector dropdown",
        "Controlled component returning BigDecimal-compatible string"
      ],
      "priority": 56,
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "7.2.1",
      "phase": "UI Layer",
      "epic": "Pages",
      "title": "Implement chart of accounts page",
      "description": "Create page for viewing and managing the chart of accounts.",
      "acceptance_criteria": [
        "Route: /companies/:companyId/accounts",
        "List all accounts in hierarchy (tree view)",
        "Add new account form (modal or slide-over)",
        "Edit account (inline or modal)",
        "Deactivate account (soft delete)",
        "Filter by account type",
        "Uses TanStack Router loader for data fetching"
      ],
      "priority": 57,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "7.2.2",
      "phase": "UI Layer",
      "epic": "Pages",
      "title": "Implement journal entry form",
      "description": "Create form for creating and editing journal entries with dynamic lines.",
      "acceptance_criteria": [
        "Route: /companies/:companyId/journal-entries/new and /edit/:id",
        "Add/remove lines dynamically",
        "Account selector for each line",
        "Debit/credit currency inputs",
        "Running balance display (debits - credits)",
        "Validation feedback (unbalanced, missing fields)",
        "Save as draft or submit for approval buttons"
      ],
      "priority": 58,
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "7.2.3",
      "phase": "UI Layer",
      "epic": "Pages",
      "title": "Implement report viewer page",
      "description": "Create page for viewing and exporting financial reports.",
      "acceptance_criteria": [
        "Route: /companies/:companyId/reports",
        "Report type selector: Trial Balance, Balance Sheet, Income Statement, Cash Flow",
        "Date/period parameter inputs",
        "Report display with proper formatting (indentation, subtotals, totals)",
        "Drill-down to transactions (click account to see entries)",
        "Export to PDF/Excel (can be future enhancement)"
      ],
      "priority": 59,
      "status": "pending",
      "estimated_complexity": "large"
    }
  ]
}
