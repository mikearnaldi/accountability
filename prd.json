{
  "project": "Accountability",
  "description": "Multi-company, multi-currency accounting application built on US GAAP principles",
  "version": "1.0.0",
  "created_at": "2026-01-10",
  "updated_at": "2026-01-10",
  "specs_dir": "specs/",
  "available_specs": [
    "ACCOUNTING_RESEARCH.md",
    "HTTP_API_TANSTACK.md",
    "API_BEST_PRACTICES.md"
  ],
  "technology": {
    "effect": {
      "version": "^3.19.0",
      "notes": "Schema is included in core effect package since 3.10.0. Import as: import * as Schema from 'effect/Schema'"
    },
    "effect_sql": {
      "packages": [
        "@effect/sql",
        "@effect/sql-pg",
        "@effect/sql-drizzle"
      ],
      "notes": "@effect/sql-pg requires @effect/experimental and @effect/platform as peer deps"
    },
    "effect_vitest": {
      "package": "@effect/vitest",
      "version": "^0.27.0",
      "peer_deps": [
        "vitest ^3.2.0"
      ]
    },
    "tanstack_start": {
      "package": "@tanstack/react-start",
      "version": "^1.147.0",
      "peer_deps": [
        "react ^19.0.0",
        "react-dom ^19.0.0",
        "vite ^7.0.0"
      ],
      "notes": "Use for file-based routing. API served via Effect HttpApi with HttpApiBuilder.toWebHandler at /api route. See specs/HTTP_API_TANSTACK.md"
    },
    "effect_platform": {
      "packages": [
        "@effect/platform",
        "@effect/platform-node"
      ],
      "notes": "Required for HttpApi and HttpApiClient. Use HttpApiBuilder for server handlers, HttpApiClient for type-safe client."
    },
    "effect_atom": {
      "packages": [
        "@effect-atom/atom",
        "@effect-atom/atom-react"
      ],
      "notes": "For reactive state management with Effect. See repos/effect-atom/ for source and specs/HTTP_API_TANSTACK.md Part 3 for patterns."
    }
  },
  "reference_repos": {
    "effect": "repos/effect/packages/effect/src/",
    "effect_sql": "repos/effect/packages/sql/src/",
    "effect_sql_pg": "repos/effect/packages/sql-pg/src/",
    "effect_sql_drizzle": "repos/effect/packages/sql-drizzle/src/",
    "effect_vitest": "repos/effect/packages/vitest/src/",
    "effect_atom": "repos/effect-atom/packages/atom/src/",
    "effect_atom_react": "repos/effect-atom/packages/atom-react/src/",
    "tanstack_start": "repos/tanstack-router/packages/react-start/src/",
    "tanstack_examples": "repos/tanstack-router/examples/react/start-basic/"
  },
  "stories": [
    {
      "id": "1.1.1",
      "phase": "Foundation",
      "epic": "Project Setup",
      "title": "Initialize monorepo structure",
      "description": "Set up pnpm workspaces with packages for core, persistence, api, and web. Configure root package.json with workspace definitions. Reference repos/effect/pnpm-workspace.yaml for workspace structure.",
      "acceptance_criteria": [
        "pnpm-workspace.yaml exists with package paths",
        "Root package.json has workspace configuration",
        "packages/core, packages/persistence, packages/api, packages/web directories exist",
        "Each package has its own package.json with correct name (@accountability/core, etc.)"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.1.2",
      "phase": "Foundation",
      "epic": "Project Setup",
      "title": "Configure TypeScript with strict mode",
      "description": "Set up TypeScript configuration with strict mode enabled. Create base tsconfig.json and package-specific configs that extend it. Reference repos/effect/tsconfig.base.json for configuration patterns.",
      "acceptance_criteria": [
        "Root tsconfig.base.json with strict: true and modern settings",
        "Each package has tsconfig.json extending base",
        "TypeScript compiles without errors",
        "Path aliases configured for cross-package imports"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.1.3",
      "phase": "Foundation",
      "epic": "Project Setup",
      "title": "Set up Effect",
      "description": "Install Effect package in core. Schema is included in the core effect package since v3.10.0 - import as 'effect/Schema'. Reference repos/effect/packages/effect/src/Schema.ts for Schema API.",
      "acceptance_criteria": [
        "effect ^3.19.0 package installed in core",
        "Basic Effect program runs successfully using Effect.gen",
        "Schema validation works using import * as Schema from 'effect/Schema'",
        "Context and Layer patterns work for dependency injection"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.1.4",
      "phase": "Foundation",
      "epic": "Project Setup",
      "title": "Configure Vitest with Effect integration",
      "description": "Set up Vitest with @effect/vitest for testing Effect-based code. Reference repos/effect/packages/vitest/src/ for test patterns. Include coverage reporting.",
      "acceptance_criteria": [
        "vitest ^3.2.0 installed",
        "@effect/vitest ^0.27.0 installed for Effect test utilities",
        "Test command works in each package",
        "Coverage reporting enabled with v8 provider",
        "Example Effect test passes using @effect/vitest patterns"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.1.5",
      "phase": "Foundation",
      "epic": "Project Setup",
      "title": "Set up ESLint and Prettier",
      "description": "Configure ESLint with TypeScript support and Prettier for code formatting. Reference repos/effect/eslint.config.mjs for ESLint flat config patterns.",
      "acceptance_criteria": [
        "ESLint configured with flat config (eslint.config.mjs)",
        "TypeScript ESLint parser configured",
        "Prettier configured with consistent style",
        "Lint script runs without errors on initial codebase",
        "Format script properly formats code"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.2.1",
      "phase": "Foundation",
      "epic": "Core Value Objects",
      "title": "Implement MonetaryAmount value object",
      "description": "Create MonetaryAmount as a composite value object with decimal amount (high precision) and currency code. Use Schema from effect/Schema. Reference repos/effect/packages/effect/src/BigDecimal.ts for decimal handling.",
      "acceptance_criteria": [
        "MonetaryAmount schema using Schema.Struct with BigDecimal and CurrencyCode",
        "Use BigDecimal from effect/BigDecimal for precision",
        "Minimum 4 decimal places precision",
        "Validation rejects invalid currencies",
        "Arithmetic operations (add, subtract, multiply, divide) implemented using BigDecimal",
        "100% test coverage",
        "Do not accept any less than 100% test coverage, don't back off from tasks!",
        "Investigate deeply the issue of Equal not picking up"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.2.2",
      "phase": "Foundation",
      "epic": "Core Value Objects",
      "title": "Implement CurrencyCode value object",
      "description": "Create branded CurrencyCode type validated against ISO 4217 pattern (3 uppercase letters). Use Schema.String.pipe(Schema.pattern(), Schema.brand()). Reference repos/effect/packages/effect/src/Brand.ts.",
      "acceptance_criteria": [
        "CurrencyCode as Schema.String with pattern /^[A-Z]{3}$/ and brand",
        "Common currencies (USD, GBP, EUR, JPY) pass validation",
        "Invalid codes (lowercase, wrong length) rejected",
        "Type is branded for compile-time safety",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.2.3",
      "phase": "Foundation",
      "epic": "Core Value Objects",
      "title": "Implement AccountNumber value object",
      "description": "Create branded AccountNumber type following the numbering convention (1000-9999 ranges for different account types). Reference repos/effect/packages/effect/src/Schema.ts for filter and brand patterns.",
      "acceptance_criteria": [
        "AccountNumber branded type using Schema.String with validation",
        "Validation ensures 4-digit numeric format",
        "Helper function to determine AccountType from number range",
        "Ranges: 1xxx=Assets, 2xxx=Liabilities, 3xxx=Equity, 4xxx=Revenue, 5xxx-7xxx=Expenses",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.2.4",
      "phase": "Foundation",
      "epic": "Core Value Objects",
      "title": "Implement remaining core value objects",
      "description": "Implement JurisdictionCode (ISO 3166-1), Percentage (0-100), LocalDate, Timestamp, and FiscalPeriodRef value objects. Reference repos/effect/packages/effect/src/DateTime.ts for date handling.",
      "acceptance_criteria": [
        "JurisdictionCode with ISO 3166-1 alpha-2 validation (/^[A-Z]{2}$/)",
        "Percentage as Schema.Number with filter for 0-100 range, supports decimals",
        "LocalDate using Schema wrapper around effect/DateTime",
        "Timestamp for UTC timestamps using DateTime.Utc",
        "FiscalPeriodRef as Schema.Struct with year (number) and period (1-13)",
        "100% test coverage for all",
        "Use TestClock to test the nowEffect"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.2.5",
      "phase": "Foundation",
      "epic": "Core Value Objects",
      "title": "Align all value objects to Schema constructor standards",
      "description": "Revise all value objects created in 1.2.x to follow Effect Schema best practices: use Schema.Class instead of Schema.Struct where appropriate, remove redundant make/create functions (Schema provides .make() automatically), use flat module structure without barrel files, ensure all branded types use the Schema-provided .make() constructor.",
      "acceptance_criteria": [
        "All domain entities use Schema.Class instead of Schema.Struct",
        "Remove all custom make/create functions - use MyClass.make() or BrandedType.make() from Schema",
        "Flatten module structure - no index.ts barrel files, each type in its own file at src/ level",
        "Ensure Equal and Hash are auto-derived (no manual implementations)",
        "All tests pass after refactoring",
        "Type guards use Schema.is(MySchema) not custom implementations",
        "Value equality in Schema.Class compares fields via Equals, so you don't need a custom equality to handle BigDecimal",
        "Don't create dumb renamed function for tests like mkTs use proper constructors directly",
        "Remove the bd() utility use the BigDecimal.unsafeFromString in tests"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.3.1",
      "phase": "Foundation",
      "epic": "Core Entities",
      "title": "Implement Organization entity",
      "description": "Create Organization entity as the top-level container for companies with reporting currency and settings. Use Schema.Class or Schema.Struct pattern. Reference repos/effect/packages/effect/src/Schema.ts for Class patterns.",
      "acceptance_criteria": [
        "Organization schema with id, name, reportingCurrency, createdAt, settings",
        "OrganizationId as branded UUID string",
        "Use Schema.Struct or Schema.Class pattern",
        "Validation for required fields",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.3.2",
      "phase": "Foundation",
      "epic": "Core Entities",
      "title": "Implement Company entity",
      "description": "Create Company entity with functional currency, jurisdiction, fiscal settings, and consolidation properties.",
      "specs": [
        "ACCOUNTING_RESEARCH.md"
      ],
      "acceptance_criteria": [
        "Company schema with all properties from spec",
        "CompanyId branded type (UUID)",
        "Functional and reporting currency as CurrencyCode",
        "Parent company reference as optional CompanyId",
        "Ownership percentage using Percentage value object",
        "ConsolidationMethod enum: FullConsolidation, EquityMethod, CostMethod, VariableInterestEntity",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.3.3",
      "phase": "Foundation",
      "epic": "Core Entities",
      "title": "Implement Currency entity",
      "description": "Create Currency entity with ISO code, name, symbol, decimal places, and active status.",
      "acceptance_criteria": [
        "Currency schema with code (CurrencyCode), name, symbol, decimalPlaces, isActive",
        "Decimal places as Schema.Literal(0, 2, 3, 4)",
        "Predefined common currencies (USD, EUR, GBP, JPY, etc.)",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.3.4",
      "phase": "Foundation",
      "epic": "Core Entities",
      "title": "Implement ExchangeRate entity",
      "description": "Create ExchangeRate entity with from/to currencies, rate, effective date, rate type, and source.",
      "acceptance_criteria": [
        "ExchangeRate schema with all properties",
        "ExchangeRateId branded type",
        "RateType as Schema.Literal: 'Spot', 'Average', 'Historical', 'Closing'",
        "RateSource as Schema.Literal: 'Manual', 'Import', 'API'",
        "Rate as positive BigDecimal",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.3.5",
      "phase": "Foundation",
      "epic": "Core Entities",
      "title": "Implement Jurisdiction entity",
      "description": "Create Jurisdiction entity with country code, name, default currency, and tax settings.",
      "acceptance_criteria": [
        "Jurisdiction schema with code (JurisdictionCode), name, defaultCurrency, taxSettings",
        "TaxSettings as Schema.Struct with configurable tax rules",
        "Predefined jurisdictions for US and GB",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "1.4.1",
      "phase": "Foundation",
      "epic": "Chart of Accounts",
      "title": "Implement Account entity",
      "description": "Create Account entity with full classification including type, category, normal balance, hierarchy, and behavior properties.",
      "specs": [
        "ACCOUNTING_RESEARCH.md"
      ],
      "acceptance_criteria": [
        "Account schema with all properties from spec",
        "AccountId branded type",
        "AccountType as Schema.Literal: 'Asset', 'Liability', 'Equity', 'Revenue', 'Expense'",
        "AccountCategory enum with all subcategories per type",
        "NormalBalance as Schema.Literal: 'Debit', 'Credit'",
        "CashFlowCategory as Schema.Literal: 'Operating', 'Investing', 'Financing', 'NonCash'",
        "Parent account reference as optional AccountId for hierarchy",
        "Intercompany properties: isIntercompany flag, intercompanyPartnerId",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "1.4.2",
      "phase": "Foundation",
      "epic": "Chart of Accounts",
      "title": "Implement account hierarchy logic",
      "description": "Create pure functions to manage account hierarchy - building trees, calculating rollups, and validating parent-child relationships. Use effect/Array utilities.",
      "acceptance_criteria": [
        "Function buildAccountTree: Account[] -> AccountNode[] (tree structure)",
        "Function getDescendants: (accounts: Account[], accountId: AccountId) -> Account[]",
        "Function getAncestors: (accounts: Account[], accountId: AccountId) -> Account[]",
        "Validation that child account type matches parent type",
        "100% test coverage with property-based tests",
        "Use FastCheck from the effect re-export",
        "Use Schema to define custom classes",
        "Use Schema.Chunk not Schema.ChunkFromSelf so that it is serializeable"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.4.3",
      "phase": "Foundation",
      "epic": "Chart of Accounts",
      "title": "Implement account validation rules",
      "description": "Create validation functions for accounts including number range checks, category consistency, and intercompany configuration. Return typed errors.",
      "acceptance_criteria": [
        "Validate account number is in correct range for type (1xxx=Assets, etc.)",
        "Validate normal balance is correct for account type (Assets=Debit, etc.)",
        "Validate intercompany accounts have partner company set",
        "Validate cash flow category only set for balance sheet accounts",
        "Return Schema.TaggedError for validation failures",
        "100% test coverage",
        "Don't use *FromSelf we want everything to be serializeable"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.4.4",
      "phase": "Foundation",
      "epic": "Chart of Accounts",
      "title": "Create standard account templates",
      "description": "Create predefined account templates for General Business, Manufacturing, Service Business, and Holding Company. Templates are pure data structures.",
      "acceptance_criteria": [
        "GeneralBusinessTemplate with ~50 standard accounts covering all types",
        "ManufacturingTemplate extending general with inventory and COGS detail accounts",
        "ServiceBusinessTemplate with service revenue focus",
        "HoldingCompanyTemplate with investment and intercompany accounts",
        "Function instantiateTemplate: (template, companyId) -> Account[]",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.5.1",
      "phase": "Foundation",
      "epic": "Journal Entries",
      "title": "Implement JournalEntry entity",
      "description": "Create JournalEntry entity with header properties including dates, period, type, status, and audit information.",
      "specs": [
        "ACCOUNTING_RESEARCH.md"
      ],
      "acceptance_criteria": [
        "JournalEntry schema with all header properties",
        "JournalEntryId branded type (UUID)",
        "EntryNumber as branded string for sequential numbering",
        "JournalEntryType as Schema.Literal with all types from spec",
        "JournalEntryStatus as Schema.Literal: 'Draft', 'PendingApproval', 'Approved', 'Posted', 'Reversed'",
        "SourceModule as Schema.Literal for originating module",
        "Reversal tracking: isReversing, reversedEntryId, reversingEntryId",
        "Audit fields: createdBy, createdAt, postedBy, postedAt",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "1.5.2",
      "phase": "Foundation",
      "epic": "Journal Entries",
      "title": "Implement JournalEntryLine entity",
      "description": "Create JournalEntryLine entity with account, amounts in transaction and functional currencies, and intercompany properties.",
      "acceptance_criteria": [
        "JournalEntryLine schema with all properties",
        "JournalEntryLineId branded type",
        "Schema.filter to ensure exactly one of debit/credit is set (not both, not neither)",
        "Transaction currency amounts as MonetaryAmount",
        "Functional currency amounts with exchangeRate as BigDecimal",
        "Optional memo as Schema.String",
        "Optional dimensions as Record<string, string> for reporting",
        "Intercompany: partnerId and matchingLineId as optional",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.5.3",
      "phase": "Foundation",
      "epic": "Journal Entries",
      "title": "Implement balance validation",
      "description": "Create the fundamental validation that total debits equal total credits for a journal entry. Use BigDecimal for precision.",
      "acceptance_criteria": [
        "Function sumDebits: JournalEntryLine[] -> BigDecimal",
        "Function sumCredits: JournalEntryLine[] -> BigDecimal",
        "Function validateBalance: JournalEntry -> Effect<void, UnbalancedEntryError>",
        "Support for multi-currency entries (compare in functional currency)",
        "UnbalancedEntryError extends Schema.TaggedError with debit/credit totals",
        "Property-based test: all valid entries have equal debits and credits",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.5.4",
      "phase": "Foundation",
      "epic": "Journal Entries",
      "title": "Implement multi-currency line handling",
      "description": "Create logic for handling journal entry lines in different currencies, converting to functional currency.",
      "acceptance_criteria": [
        "Function convertToFunctional: (amount: MonetaryAmount, rate: BigDecimal, functionalCurrency: CurrencyCode) -> MonetaryAmount",
        "Validation that exchange rate is provided when transaction currency differs from functional",
        "Calculation stores both original and functional amounts on line",
        "MissingExchangeRateError for missing rates",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "1.5.5",
      "phase": "Foundation",
      "epic": "Journal Entries",
      "title": "Implement entry status workflow",
      "description": "Create state machine for journal entry status transitions with validation of allowed transitions. Use Match from effect for pattern matching.",
      "acceptance_criteria": [
        "Status transition rules as pure data structure",
        "Draft -> PendingApproval: allowed",
        "PendingApproval -> Approved: allowed",
        "PendingApproval -> Draft: allowed (rejection)",
        "Approved -> Posted: allowed",
        "Posted -> Reversed: only via separate reversal entry creation",
        "InvalidStatusTransitionError for disallowed transitions",
        "Function canTransition: (from: Status, to: Status) -> boolean",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "2.1.1",
      "phase": "Core Services",
      "epic": "Journal Entry Service",
      "title": "Implement journal entry creation service",
      "description": "Create Effect service for creating new journal entries with full validation. Use Context.Tag and Layer patterns. Reference repos/effect/packages/effect/src/Context.ts.",
      "acceptance_criteria": [
        "JournalEntryService defined with Context.Tag pattern",
        "create operation returns Effect<JournalEntry, JournalEntryError, Dependencies>",
        "Validates balance before creation",
        "Validates all accounts exist and are postable via AccountRepository",
        "Validates period is open via PeriodRepository",
        "Assigns sequential entry number",
        "JournalEntryError as union of specific error types",
        "JournalEntryServiceLive as Layer implementation",
        "100% test coverage with mocked dependencies"
      ],
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "2.1.2",
      "phase": "Core Services",
      "epic": "Journal Entry Service",
      "title": "Implement journal entry posting",
      "description": "Create service operation to post an approved journal entry to the general ledger.",
      "acceptance_criteria": [
        "post operation in JournalEntryService",
        "Validates entry is in 'Approved' status",
        "Validates period is still open",
        "Updates status to 'Posted'",
        "Records postedBy (UserId) and postedAt (Timestamp)",
        "Returns typed errors: NotApprovedError, PeriodClosedError",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "2.1.3",
      "phase": "Core Services",
      "epic": "Journal Entry Service",
      "title": "Implement journal entry reversal",
      "description": "Create service operation to reverse a posted journal entry by creating a reversing entry.",
      "acceptance_criteria": [
        "reverse operation in JournalEntryService",
        "Creates new entry with opposite debits/credits (swap debit<->credit on each line)",
        "New entry has isReversing=true and reversedEntryId set",
        "Updates original entry with reversingEntryId",
        "Updates original entry status to 'Reversed'",
        "Reversal entry is created as Posted (bypasses approval)",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "2.2.1",
      "phase": "Core Services",
      "epic": "Currency Service",
      "title": "Implement exchange rate management",
      "description": "Create CurrencyService for managing exchange rates including CRUD operations and rate lookups.",
      "acceptance_criteria": [
        "CurrencyService with Context.Tag pattern",
        "createRate, updateRate operations",
        "getRate: (from, to, date, type) -> Effect<ExchangeRate, RateNotFoundError>",
        "getLatestRate: (from, to) -> Effect<ExchangeRate, RateNotFoundError>",
        "Depends on ExchangeRateRepository",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "2.2.2",
      "phase": "Core Services",
      "epic": "Currency Service",
      "title": "Implement currency translation",
      "description": "Create service operation for translating amounts between currencies using appropriate rates.",
      "acceptance_criteria": [
        "translate: (amount, toCurrency, date, rateType) -> Effect<TranslationResult>",
        "TranslationResult includes: originalAmount, translatedAmount, rateUsed, rateDate",
        "Support Spot, Average, Historical, Closing rate types",
        "Handle currency pairs in either direction (USD->EUR and EUR->USD)",
        "Inverse rate calculation when direct rate not available",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "2.2.3",
      "phase": "Core Services",
      "epic": "Currency Service",
      "title": "Implement period-end revaluation",
      "description": "Create service operation for revaluing foreign currency monetary items at period end per ASC 830.",
      "acceptance_criteria": [
        "revalue: (companyId, periodId, closingDate) -> Effect<RevaluationResult>",
        "Identify monetary accounts (cash, receivables, payables) with foreign currency balances",
        "Calculate unrealized gain/loss using closing rate vs. book rate",
        "Generate revaluation journal entry automatically",
        "RevaluationResult with per-account detail and total gain/loss",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "2.3.1",
      "phase": "Core Services",
      "epic": "Period Management",
      "title": "Implement fiscal year and period creation",
      "description": "Create PeriodService for creating fiscal years with periods based on company fiscal settings.",
      "acceptance_criteria": [
        "PeriodService with Context.Tag pattern",
        "createFiscalYear: (companyId, startDate) -> Effect<FiscalYear>",
        "Auto-generate 12 monthly periods based on company's fiscal year settings",
        "Support for period 13 (adjustment period) as optional",
        "Validate year doesn't overlap existing years for company",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "2.3.2",
      "phase": "Core Services",
      "epic": "Period Management",
      "title": "Implement period open/close logic",
      "description": "Create service operations for opening and closing fiscal periods with proper validations.",
      "acceptance_criteria": [
        "openPeriod: (periodId) -> Effect<FiscalPeriod, PeriodError>",
        "closePeriod: (periodId) -> Effect<FiscalPeriod, PeriodError>",
        "softClosePeriod for limited posting (requires approval)",
        "Validate no Draft entries exist before close",
        "reopenPeriod with audit trail (requires reason)",
        "PeriodError union: HasDraftEntriesError, AlreadyClosedError, etc.",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "2.3.3",
      "phase": "Core Services",
      "epic": "Period Management",
      "title": "Implement year-end close process",
      "description": "Create service for year-end closing including closing entries to retained earnings.",
      "acceptance_criteria": [
        "closeYear: (fiscalYearId, retainedEarningsAccountId) -> Effect<YearEndResult>",
        "Generate closing entries for all income accounts (credit to RE)",
        "Generate closing entries for all expense accounts (debit to RE)",
        "Net income = total revenue credits - total expense debits",
        "Generate opening balances for new year (balance sheet accounts)",
        "Support year reopen: creates reversing entries for closing entries",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "2.3.4",
      "phase": "Core Services",
      "epic": "Code Organization",
      "title": "Reorganize core package into domain and services",
      "description": "Restructure packages/core/src into src/domain for domain modules (value objects, entities, aggregates) and src/services for Effect services. Update all imports and ensure tests pass.",
      "acceptance_criteria": [
        "Create src/domain directory for all domain modules (Account, Company, Currency, etc.)",
        "Create src/services directory for all Effect services",
        "Move value objects and entities to src/domain/",
        "Move services to src/services/",
        "Update all test imports to use new paths",
        "All tests pass after reorganization"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "2.3.5",
      "phase": "Core Services",
      "epic": "Code Organization",
      "title": "Reorganize core package tests into domain and services",
      "description": "Restructure packages/core/test to mirror the src structure with test/domain for domain module tests and test/services for service tests. Update tsconfig.test.json if needed.",
      "acceptance_criteria": [
        "Create test/domain directory for all domain module tests",
        "Create test/services directory for all service tests",
        "Move domain tests (Account.test.ts, Company.test.ts, etc.) to test/domain/",
        "Move service tests to test/services/",
        "Update tsconfig.test.json include paths if needed",
        "All tests pass after reorganization",
        "Test coverage remains at 100%"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "3.1.1",
      "phase": "Reporting Engine",
      "epic": "Trial Balance",
      "title": "Implement account balance calculation",
      "description": "Create pure functions to calculate account balances from posted journal entries. Use BigDecimal for all calculations.",
      "acceptance_criteria": [
        "calculateBalance: (accountId, entries, asOfDate) -> BigDecimal",
        "calculatePeriodBalance: (accountId, entries, periodStart, periodEnd) -> BigDecimal",
        "calculateYTDBalance: (accountId, entries, fiscalYearStart, asOfDate) -> BigDecimal",
        "calculateBeginningBalance: (accountId, entries, periodStart) -> BigDecimal",
        "Handle debit/credit normal balances correctly (debits increase assets, credits increase liabilities)",
        "All functions are pure - no side effects",
        "100% test coverage with property-based tests"
      ],
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "3.1.2",
      "phase": "Reporting Engine",
      "epic": "Trial Balance",
      "title": "Implement trial balance report",
      "description": "Create trial balance report showing all account balances with debit/credit columns.",
      "acceptance_criteria": [
        "TrialBalanceReport schema with metadata and line items",
        "generateTrialBalance: (companyId, asOfDate) -> Effect<TrialBalanceReport>",
        "Shows all accounts with non-zero balances",
        "Debit and credit columns (not net balance)",
        "Total debits equals total credits (validation)",
        "Support for filtering by date range",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "3.2.1",
      "phase": "Reporting Engine",
      "epic": "Balance Sheet",
      "title": "Implement balance sheet report",
      "description": "Create balance sheet report with current/non-current classification per ASC 210.",
      "acceptance_criteria": [
        "BalanceSheetReport schema with sections and line items",
        "generateBalanceSheet: (companyId, asOfDate, options) -> Effect<BalanceSheetReport>",
        "Sections: Current Assets, Non-Current Assets, Current Liabilities, Non-Current Liabilities, Equity",
        "Line items grouped by AccountCategory",
        "Subtotals for each section",
        "Validation: Total Assets = Total Liabilities + Total Equity",
        "Support for comparative periods (prior year/period)",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "3.3.1",
      "phase": "Reporting Engine",
      "epic": "Income Statement",
      "title": "Implement income statement report",
      "description": "Create income statement report with multi-step format and expenses by function per ASC 220.",
      "acceptance_criteria": [
        "IncomeStatementReport schema with sections",
        "generateIncomeStatement: (companyId, periodStart, periodEnd, options) -> Effect<IncomeStatementReport>",
        "Multi-step format: Revenue -> COGS -> Gross Profit -> OpEx -> Operating Income -> Other -> Net Income",
        "Expenses grouped by function (per US GAAP requirement)",
        "Subtotals: Gross Profit, Operating Income, Income Before Tax, Net Income",
        "Support for comparative periods",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "3.4.1",
      "phase": "Reporting Engine",
      "epic": "Cash Flow Statement",
      "title": "Implement cash flow statement - indirect method",
      "description": "Create cash flow statement using indirect method per ASC 230. This is complex - requires analyzing account changes.",
      "acceptance_criteria": [
        "CashFlowStatementReport schema",
        "generateCashFlowStatement: (companyId, periodStart, periodEnd) -> Effect<CashFlowStatementReport>",
        "Operating: Start with Net Income, adjust for non-cash items and working capital changes",
        "Investing: Capital expenditures, asset sales, investment activity",
        "Financing: Debt, equity, dividends",
        "Net change in cash reconciles to balance sheet cash movement",
        "Supplemental disclosures: Interest paid, Taxes paid",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "3.5.1",
      "phase": "Reporting Engine",
      "epic": "Statement of Equity",
      "title": "Implement statement of changes in equity",
      "description": "Create statement of changes in equity showing movements in each equity component.",
      "acceptance_criteria": [
        "EquityStatementReport schema with component columns and movement rows",
        "generateEquityStatement: (companyId, periodStart, periodEnd) -> Effect<EquityStatementReport>",
        "Columns: Common Stock, APIC, Retained Earnings, Treasury Stock, AOCI, NCI (if consolidated)",
        "Rows: Opening Balance, Net Income, OCI, Dividends, Stock Issuance/Repurchase, Closing Balance",
        "Column totals and row totals",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "3.5.2",
      "phase": "Reporting Engine",
      "epic": "Data Integrity",
      "title": "Replace Array/ReadonlyArray with Chunk in domain models",
      "description": "Structural equality (Equal.equals) does not work correctly with nested plain arrays. Replace all Array and ReadonlyArray usages in domain models with Chunk from effect, which properly implements Equal and Hash for structural comparison.",
      "acceptance_criteria": [
        "Audit all domain models for Array/ReadonlyArray usage",
        "Replace Schema.Array with Schema.Chunk where structural equality is needed",
        "Update AccountHierarchy children to use Chunk",
        "Update JournalEntry lines to use Chunk",
        "Update any other models with array fields",
        "Ensure all tests pass after migration",
        "Verify Equal.equals works correctly on nested structures",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "4.1.1",
      "phase": "Consolidation",
      "epic": "Consolidation Structure",
      "title": "Implement consolidation group entity",
      "description": "Create ConsolidationGroup entity with parent company, members, and elimination rules.",
      "acceptance_criteria": [
        "ConsolidationGroup schema with all properties from spec",
        "ConsolidationGroupId branded type",
        "Members as array of ConsolidationMember (companyId, ownershipPct, method, acquisitionDate)",
        "EliminationRules as array of rule references",
        "Reporting currency for consolidated statements",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "4.1.2",
      "phase": "Consolidation",
      "epic": "Consolidation Structure",
      "title": "Implement consolidation method determination",
      "description": "Create logic to determine consolidation method based on ownership and VIE status per ASC 810.",
      "acceptance_criteria": [
        "determineMethod: (ownershipPct, isVIEPrimaryBeneficiary) -> ConsolidationMethod",
        ">50% ownership -> FullConsolidation",
        "20-50% ownership -> EquityMethod",
        "<20% ownership -> CostMethod",
        "VIE primary beneficiary -> FullConsolidation regardless of ownership",
        "Pure function with comprehensive test cases",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "4.2.1",
      "phase": "Consolidation",
      "epic": "Intercompany Management",
      "title": "Implement intercompany transaction tracking",
      "description": "Create IntercompanyTransaction entity and matching logic for reconciliation.",
      "acceptance_criteria": [
        "IntercompanyTransaction schema from spec",
        "IntercompanyTransactionType enum: SalePurchase, Loan, ManagementFee, Dividend, etc.",
        "MatchingStatus enum: Matched, Unmatched, PartiallyMatched, VarianceApproved",
        "Links to journal entries on both sides",
        "Variance amount and explanation fields",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "4.2.2",
      "phase": "Consolidation",
      "epic": "Intercompany Management",
      "title": "Implement intercompany matching service",
      "description": "Create service to match intercompany transactions between companies and identify discrepancies.",
      "acceptance_criteria": [
        "IntercompanyService with Context.Tag pattern",
        "matchTransactions: (groupId, periodId) -> Effect<MatchingResult>",
        "Match by: transaction type, date (within tolerance), amount, partner company",
        "Identify unmatched transactions on each side",
        "Calculate variances for partial matches",
        "Generate matching report with discrepancy details",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "4.3.1",
      "phase": "Consolidation",
      "epic": "Elimination Engine",
      "title": "Implement elimination rule entity",
      "description": "Create EliminationRule entity with trigger conditions and account mappings.",
      "acceptance_criteria": [
        "EliminationRule schema with all properties from spec",
        "EliminationType enum from spec",
        "AccountSelector: byId, byRange, byCategory",
        "Debit and credit account targets for elimination entry",
        "isAutomatic flag for auto-processing",
        "Priority for ordering",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "4.3.2",
      "phase": "Consolidation",
      "epic": "Elimination Engine",
      "title": "Implement automatic elimination generation",
      "description": "Create service to automatically generate elimination entries based on rules.",
      "acceptance_criteria": [
        "EliminationService with Context.Tag pattern",
        "generateEliminations: (groupId, periodId, rules) -> Effect<EliminationEntry[]>",
        "Process rules in priority order",
        "Generate journal entries for each elimination",
        "Types: IC AR/AP, IC Revenue/Expense, IC Dividend, Investment vs Equity, Unrealized profit",
        "Each elimination entry links to the rule that generated it",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "4.4.1",
      "phase": "Consolidation",
      "epic": "Consolidation Run",
      "title": "Implement consolidation run orchestration",
      "description": "Create ConsolidationRun entity and service to orchestrate the full consolidation process.",
      "acceptance_criteria": [
        "ConsolidationRun schema with status and steps from spec",
        "ConsolidationService.run: (groupId, periodId, options) -> Effect<ConsolidationRun>",
        "Execute steps in order: Validate -> Translate -> Aggregate -> Match IC -> Eliminate -> NCI -> Generate TB",
        "Track progress, timing, and status of each step",
        "Handle step failures gracefully (mark run as Failed, store error)",
        "Store resulting consolidated trial balance",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "4.4.2",
      "phase": "Consolidation",
      "epic": "Consolidation Run",
      "title": "Implement currency translation for consolidation",
      "description": "Create translation step that translates all member balances to reporting currency per ASC 830.",
      "acceptance_criteria": [
        "translateMemberBalances: (member, reportingCurrency, rates) -> Effect<TranslatedTrialBalance>",
        "Assets/Liabilities: Closing rate",
        "Income/Expense: Average rate (or transaction date rate)",
        "Equity (capital accounts): Historical rate",
        "Retained Earnings: Calculated (opening + NI - dividends)",
        "Calculate CTA (Cumulative Translation Adjustment) as plug to OCI",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "4.4.3",
      "phase": "Consolidation",
      "epic": "Consolidation Run",
      "title": "Implement minority interest calculation",
      "description": "Create calculation for non-controlling interest share of subsidiary equity and income.",
      "acceptance_criteria": [
        "calculateNCI: (subsidiary, ownershipPct) -> NCIResult",
        "NCI % = 100% - parent ownership %",
        "NCI share of subsidiary equity (at acquisition + subsequent changes)",
        "NCI share of subsidiary net income for period",
        "Separate NCI line items in consolidated statements",
        "100% test coverage"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "5.0.1",
      "phase": "Persistence",
      "epic": "Test Infrastructure",
      "title": "Set up testcontainers for persistence tests",
      "description": "Create testcontainers infrastructure for running persistence tests against a real PostgreSQL database. Follow the pattern from @effect/sql-pg where testcontainers are wrapped in Effect layers and provided to tests via it.layer(). This enables integration tests that verify actual database behavior.",
      "acceptance_criteria": [
        "Install @testcontainers/postgresql as dev dependency in persistence package",
        "Create test/utils.ts with PgContainer Effect.Service following sql-pg pattern",
        "Use Effect.acquireRelease to manage container lifecycle (start on acquire, stop on release)",
        "Use Layer.unwrapEffect to create PgClient layer from container connection URI",
        "Export PgContainer.ClientLive layer for use in tests",
        "Create ContainerError as Data.TaggedError for container startup failures",
        "Configure test timeout to 30 seconds (container startup is slow)",
        "Verify pattern works with example test using it.layer(PgContainer.ClientLive)",
        "Document pattern in CLAUDE.md under Testing section",
        "Example test should create table, insert row, query it back"
      ],
      "technical_details": {
        "pattern": "Effect.Service with scoped Effect.acquireRelease for container lifecycle",
        "reference": "repos/effect/packages/sql-pg/test/utils.ts",
        "key_imports": [
          "PostgreSqlContainer from @testcontainers/postgresql",
          "PgClient from @effect/sql-pg",
          "Effect, Layer, Redacted, Data from effect"
        ],
        "container_layer_pattern": "Layer.unwrapEffect(Effect.gen) to get container URI then create PgClient.layer",
        "test_pattern": "it.layer(PgContainer.ClientLive, { timeout: '30 seconds' })('description', (it) => { ... })"
      },
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "5.1.1",
      "phase": "Persistence",
      "epic": "Repository Interfaces",
      "title": "Define repository interfaces",
      "description": "Create Effect-based repository interfaces for all core entities. Use Context.Tag pattern. Reference repos/effect/packages/sql/src/ for patterns.",
      "acceptance_criteria": [
        "Repository interfaces using Context.Tag pattern",
        "CompanyRepository: findById, findByOrg, create, update",
        "AccountRepository: findById, findByCompany, create, update, findByNumber",
        "JournalEntryRepository: findById, findByCompany, findByPeriod, create, update",
        "ExchangeRateRepository: findRate, findLatestRate, create",
        "FiscalPeriodRepository: findById, findByCompany, findOpen, create, update",
        "ConsolidationRepository: findGroup, findRun, createRun, updateRun",
        "All operations return Effect with typed errors"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "5.1.2",
      "phase": "Persistence",
      "epic": "Repository Interfaces",
      "title": "Switch to moduleResolution bundler with .ts imports",
      "description": "Update TypeScript configuration to use moduleResolution: bundler and change all imports to use .ts extensions directly. Remove all index.ts barrel files - import from specific modules instead.",
      "acceptance_criteria": [
        "Update tsconfig.base.json: moduleResolution set to 'bundler'",
        "Update tsconfig.base.json: rewriteRelativeImportExtensions set to true",
        "Change all .js imports to .ts imports across packages/core/src",
        "Change all .js imports to .ts imports across packages/core/test",
        "Remove all index.ts barrel files from packages/core/src",
        "Update imports that used index.ts to import from specific modules",
        "Add ESLint rule to error on .js extension in relative imports (use .ts)",
        "Add ESLint rule to error on any extension in package imports (use extensionless)",
        "Verify pnpm typecheck passes",
        "Verify pnpm test passes",
        "Verify pnpm lint passes",
        "Update CLAUDE.md with import conventions"
      ],
      "technical_details": {
        "tsconfig_changes": {
          "moduleResolution": "bundler",
          "rewriteRelativeImportExtensions": true,
          "verbatimModuleSyntax": true
        },
        "eslint_rules": {
          "relative_imports": "Error on .js in relative imports (./foo.js) - must use .ts",
          "package_imports": "Error on any extension in package imports (effect/Schema.js) - must be extensionless",
          "pattern": "Relative imports start with ./ or ../, package imports don't"
        },
        "import_pattern": "import { Foo } from './domain/Foo.ts' - TS rewrites to .js in output",
        "no_barrel_files": "Import from specific modules, not from index.ts re-exports",
        "note": "rewriteRelativeImportExtensions (TS 5.7+) rewrites .ts to .js in emitted files"
      },
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "5.2.0",
      "phase": "Persistence",
      "epic": "Database Schema",
      "title": "Remove all index.ts barrel files",
      "description": "Delete all index.ts barrel files from the codebase and update imports to point to specific modules.",
      "acceptance_criteria": [
        "Find and delete all index.ts files in packages/core/src",
        "Update all imports that used index.ts to import from specific modules",
        "Fix all docstrings to use correct import paths (no /src/ in package imports)",
        "Verify no circular dependency issues",
        "Verify pnpm typecheck passes",
        "Verify pnpm test passes"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "5.2.1",
      "phase": "Persistence",
      "epic": "Database Schema",
      "title": "Create PostgreSQL schema with SQL migrations",
      "description": "Create database schema using plain SQL migrations with @effect/sql Migrator. Write migrations as TypeScript files that execute SQL statements. Reference repos/effect/packages/sql/src/Migrator.ts.",
      "acceptance_criteria": [
        "All libraries at latest versions (@effect/sql, @effect/sql-pg, effect, etc.)",
        "Set up migrations folder: packages/persistence/src/Migrations",
        "Create migration modules as TypeScript (e.g., Migration0001.ts)",
        "Each migration exports an Effect that runs SQL via SqlClient",
        "Create Migrator layer that runs migrations on layer initialization",
        "Migrations run automatically when database layer is provided (no separate script)",
        "Migrations array defined inline: [[1, 'CreateCompanies', Migration0001], ...]",
        "Initial migrations for all core entities: companies, accounts, journal_entries, etc.",
        "Proper column types (uuid, text, numeric for BigDecimal, timestamptz)",
        "Foreign key relationships with proper cascades",
        "Indexes on: foreign keys, commonly queried fields (companyId, periodId, status)",
        "Audit columns: createdAt, updatedAt",
        "Verify migrations run successfully against testcontainers database"
      ],
      "technical_details": {
        "migration_format": "Migration0001.ts exporting Effect<void, SqlError, SqlClient>",
        "loader_pattern": "Effect.succeed([[1, 'CreateCompanies', import('./Migrations/Migration0001.ts')], ...])",
        "tracking_table": "effect_sql_migrations",
        "layer_pattern": "Migrator layer depends on SqlClient, runs migrations in Layer.effectDiscard",
        "no_scripts": "No migrate:run script or binary - migrations run in layer initialization",
        "reference": "repos/effect/packages/sql/src/Migrator.ts"
      },
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "5.2.2",
      "phase": "Persistence",
      "epic": "Database Schema",
      "title": "Module naming conventions for persistence package",
      "description": "Ensure persistence package follows module naming conventions: no index.ts files, all modules use PascalCase naming.",
      "acceptance_criteria": [
        "No index.ts barrel files in packages/persistence",
        "All module files use PascalCase naming (AccountRepository.ts, MigrationRunner.ts)",
        "Each module is self-contained, no re-exports from index files"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "5.2.3",
      "phase": "Persistence",
      "epic": "Database Schema",
      "title": "Fix all linting errors for any and type casts",
      "description": "Fix all ESLint errors caused by usage of `any` type or type casts (`x as Y`). The new lint rules @typescript-eslint/no-explicit-any and @typescript-eslint/consistent-type-assertions (assertionStyle: never) flag these violations. Replace with proper typed alternatives.",
      "acceptance_criteria": [
        "Fix all @typescript-eslint/no-explicit-any errors (263 total)",
        "Fix all @typescript-eslint/consistent-type-assertions errors",
        "Replace `any` with proper types, generics, or `unknown`",
        "Replace type casts with Schema.make(), Schema.decodeUnknown, or proper type inference",
        "If absolutely necessary, use eslint-disable-next-line with a comment explaining WHY",
        "pnpm lint passes with zero errors",
        "pnpm typecheck passes",
        "pnpm test passes"
      ],
      "technical_details": {
        "common_fixes": {
          "branded_types": "Use AccountId.make(value) instead of value as AccountId",
          "schema_parsing": "Use Schema.decodeUnknown(MySchema)(data) instead of data as MyType",
          "percentage": "Use Percentage.make(value) instead of value as Percentage",
          "nonEmptyString": "Use Schema.NonEmptyTrimmedString.make(value) instead of casting"
        },
        "escape_hatch": "// eslint-disable-next-line @typescript-eslint/consistent-type-assertions -- reason here",
        "files_affected": "AccountHierarchy.ts, AccountNumber.ts, ExchangeRate.ts, CurrencyService.ts, CurrencyTranslationService.ts, JournalEntryService.ts, NCIService.ts, PeriodService.ts, and various test files"
      },
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "5.2.4",
      "phase": "Persistence",
      "epic": "Database Schema",
      "title": "Refactor non-ideal patterns from lint fix commit",
      "description": "Clean up suboptimal patterns introduced when fixing lint errors in 5.2.3. Replace workarounds with idiomatic Effect patterns.",
      "acceptance_criteria": [
        "Replace `const x: Type = value; return Option.some(x)` with `return Option.some<Type>(value)`",
        "Replace `const x: Type = value; return x` with `return identity<Type>(value)` or proper type inference",
        "Remove unnecessary intermediate typed variables",
        "Use type parameters on Option.some<T>(), Option.none<T>(), Effect.succeed<T>() where needed",
        "Use identity<T>() from effect/Function for compile-time type verification",
        "pnpm lint passes",
        "pnpm typecheck passes",
        "pnpm test passes"
      ],
      "technical_details": {
        "bad_pattern": "const type: AccountType = 'Asset'; return Option.some(type)",
        "good_pattern": "return Option.some<AccountType>('Asset')",
        "identity_pattern": "return identity<MyType>(computedValue) // verifies type at compile time"
      },
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "5.3.1",
      "phase": "Persistence",
      "epic": "Repository Implementations",
      "title": "Implement repositories with Effect SQL",
      "description": "Implement all repository interfaces using @effect/sql and @effect/sql-pg for PostgreSQL. Use tagged template literals for queries. Reference repos/effect/packages/sql/src/ and repos/effect/packages/sql-pg/.",
      "acceptance_criteria": [
        "@effect/sql and @effect/sql-pg configured",
        "PgClient layer for PostgreSQL connection",
        "All repository interfaces implemented as Layers",
        "Use sql`` tagged template for queries with automatic parameterization",
        "Use Schema.decodeUnknown to parse query results into domain types",
        "Proper error handling: wrap SqlError in domain errors",
        "Transaction support via SqlClient.withTransaction",
        "Integration tests against testcontainers database",
        "Connection pooling configured via PgClient.layer options"
      ],
      "technical_details": {
        "query_pattern": "sql`SELECT * FROM accounts WHERE id = ${accountId}`",
        "result_parsing": "Schema.decodeUnknown(Account)(row)",
        "transactions": "sql.withTransaction(effect)",
        "reference": "repos/effect/packages/sql-pg/test/ for patterns"
      },
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "5.3.2",
      "phase": "Persistence",
      "epic": "Repository Implementations",
      "title": "Remove unnecessary eslint-disable, disableValidation, and Effect.try in repositories",
      "description": "Clean up repository implementations: remove eslint-disable comments for type assertions, remove { disableValidation: true }, use plain functions for transformations (not Effect.try/succeed), use SqlSchema for type-safe queries with Schema decoding instead of interfaces.",
      "acceptance_criteria": [
        "Remove all eslint-disable-next-line @typescript-eslint/consistent-type-assertions from packages/persistence",
        "Replace type casts with Schema.make() for branded types",
        "Replace type casts with identity<T>() for compile-time type verification where needed",
        "Remove ALL { disableValidation: true } - it is completely banned (lint rule: local/no-disable-validation)",
        "Remove Effect.try for operations that cannot throw - use plain functions for pure transformations, not Effect.succeed",
        "Keep Effect.try only for operations that might actually throw (JSON.parse, file I/O, etc.)",
        "Don't wrap safe operations in Effect unnecessarily - if it can't fail and needs no deps, it's just a function",
        "Replace Effect.catchAllCause with Effect.catchAll or Effect.mapError - catchAllCause catches defects which should propagate",
        "Remove all sql<Type>`...` patterns - banned by lint rule local/no-sql-type-parameter",
        "Use SqlSchema (findOne, findAll, single, void) for type-safe queries with Schema decoding instead of interfaces/type parameters",
        "Use pure functions for row-to-domain transformations (not Effect.try or Effect.succeed)",
        "pnpm lint passes",
        "pnpm typecheck passes",
        "pnpm test passes"
      ],
      "technical_details": {
        "files_to_check": "packages/persistence/src/*RepositoryLive.ts",
        "alternatives": [
          "Schema.make() for branded types like AccountId, CompanyId",
          "identity<T>() from effect/Function for type verification",
          "Proper return type annotations on functions"
        ],
        "rules": [
          "NEVER use eslint-disable-next-line @typescript-eslint/consistent-type-assertions unless absolutely necessary",
          "NEVER use { disableValidation: true } - completely banned, enforced by lint rule local/no-disable-validation",
          "Don't wrap safe operations in Effect unnecessarily - use plain functions for pure transformations, Effect.try only for throwing operations",
          "NEVER use Effect.catchAllCause to wrap errors - it catches defects (bugs) which should propagate. Use Effect.catchAll or Effect.mapError instead",
          "For row.field as Type - usually no cast needed if row type is properly defined. Use identity<T>() only if TypeScript can't infer, but question if types are set up right"
        ]
      },
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "5.3.3",
      "phase": "Persistence",
      "epic": "Repository Implementations",
      "title": "Fix new lint errors in repositories",
      "description": "Fix lint errors from newly added rules: local/no-sql-type-parameter and local/prefer-option-from-nullable.",
      "acceptance_criteria": [
        "Remove all sql<Type>`...` patterns - use SqlSchema with Schema for type-safe queries",
        "Replace ternary Option patterns with Option.fromNullable",
        "pnpm lint passes",
        "pnpm typecheck passes",
        "pnpm test passes"
      ],
      "technical_details": {
        "lint_rules": [
          "local/no-sql-type-parameter - use SqlSchema.findOne/findAll/single/void with Schema instead of sql<Type>",
          "local/prefer-option-from-nullable - use Option.fromNullable(x) instead of x !== null ? Option.some(x) : Option.none()"
        ],
        "files_affected": "packages/persistence/src/*RepositoryLive.ts"
      },
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "5.3.4",
      "phase": "Persistence",
      "epic": "Repository Implementations",
      "title": "Extract wrapSqlError to shared RepositoryError module",
      "description": "Extract the wrapSqlError helper function to a shared module and deduplicate across all repository implementations. Use Effect.mapError instead of Effect.catchAllCause.",
      "acceptance_criteria": [
        "Create packages/persistence/src/RepositoryError.ts with PersistenceError and wrapSqlError",
        "Use Effect.mapError (not catchAllCause) to transform SQL errors",
        "Remove duplicate wrapSqlError from all *RepositoryLive.ts files",
        "Import shared wrapSqlError in all repository implementations",
        "pnpm lint passes",
        "pnpm typecheck passes",
        "pnpm test passes"
      ],
      "technical_details": {
        "current_pattern": "const wrapSqlError = (op) => Effect.catchAllCause(...) - duplicated in each repo",
        "new_pattern": "export const wrapSqlError = (op) => Effect.mapError(...) - shared module",
        "reason": "catchAllCause catches defects which should propagate; mapError only transforms expected errors"
      },
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "5.3.5",
      "phase": "Persistence",
      "epic": "Repository Implementations",
      "title": "Resolve all ESLint errors",
      "description": "Fix all remaining ESLint errors across the codebase to ensure pnpm lint passes with zero errors.",
      "acceptance_criteria": [
        "Fix all local/no-disable-validation errors - remove { disableValidation: true }",
        "Fix all local/no-sql-type-parameter errors - use SqlSchema instead of sql<Type>",
        "Fix all local/prefer-option-from-nullable errors - use Option.fromNullable",
        "Fix all @typescript-eslint/consistent-type-imports errors - use type imports",
        "Fix any other ESLint errors that arise",
        "pnpm lint passes with zero errors",
        "pnpm typecheck passes",
        "pnpm test passes"
      ],
      "technical_details": {
        "lint_rules_to_fix": [
          "local/no-disable-validation - banned completely",
          "local/no-sql-type-parameter - use SqlSchema with Schema",
          "local/prefer-option-from-nullable - use Option.fromNullable(x)",
          "@typescript-eslint/consistent-type-imports - use import type"
        ],
        "command": "pnpm lint"
      },
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.1.1",
      "phase": "API Layer",
      "epic": "TanStack Start + Effect HttpApi Setup",
      "title": "Initialize TanStack Start with Effect HttpApi",
      "description": "Set up TanStack Start in the web package with Effect HttpApi for type-safe API endpoints.",
      "specs": [
        "HTTP_API_TANSTACK.md"
      ],
      "acceptance_criteria": [
        "@tanstack/react-start installed",
        "@tanstack/react-router for routing",
        "@effect/platform for HttpApi",
        "vite configured",
        "React 19 configured",
        "Basic route structure: / (home), /companies, /journal-entries, /reports",
        "API catch-all route /api/[...path] using HttpApiBuilder.toWebHandler",
        "Dev server runs successfully with pnpm dev"
      ],
      "technical_details": {
        "api_handler": "HttpApiBuilder.toWebHandler for TanStack Start integration",
        "route_pattern": "/api/$path catches all API requests"
      },
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.1.2",
      "phase": "API Layer",
      "epic": "TanStack Start + Effect HttpApi Setup",
      "title": "Link API handler dispose to process lifecycle",
      "description": "Ensure the dispose function from HttpApiBuilder.toWebHandler is called on process shutdown (SIGTERM, SIGINT) and module hot reload to properly clean up resources.",
      "specs": [
        "HTTP_API_TANSTACK.md"
      ],
      "acceptance_criteria": [
        "Handler dispose called on SIGTERM signal",
        "Handler dispose called on SIGINT signal",
        "Handler dispose called on Vite HMR module reload",
        "Graceful shutdown logs confirmation message",
        "No resource leaks on server restart during development"
      ],
      "technical_details": {
        "pattern": "process.on('SIGTERM', dispose); process.on('SIGINT', dispose)",
        "hmr_pattern": "if (import.meta.hot) { import.meta.hot.dispose(dispose) }"
      },
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "6.1.3",
      "phase": "API Layer",
      "epic": "TanStack Start + Effect HttpApi Setup",
      "title": "Fix lint errors and HMR dispose bug in API handler",
      "description": "Fix no-console lint errors and HMR dispose bug in packages/web/src/api/handler.ts. The HMR dispose callback currently disposes the new handler instead of the old one - need to store dispose in a global that persists across module reloads.",
      "acceptance_criteria": [
        "No lint errors in handler.ts",
        "Shutdown logging still works for debugging",
        "HMR dispose correctly disposes the OLD handler (store dispose in global)",
        "pnpm lint passes"
      ],
      "technical_details": {
        "hmr_fix": "Store dispose in global: globalThis.__apiDispose = dispose; in hot.dispose callback call the global to dispose the OLD handler before new module loads"
      },
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "6.1.4",
      "phase": "API Layer",
      "epic": "TanStack Start + Effect HttpApi Setup",
      "title": "Create shared API definition package",
      "description": "Create packages/api with HttpApi definitions shared between server and client for full type safety.",
      "acceptance_criteria": [
        "Create packages/api package",
        "Define AppApi using HttpApi.make",
        "Define API groups: AccountsApi, CompaniesApi, JournalEntriesApi, ReportsApi",
        "Define all endpoints with HttpApiEndpoint (get, post, put, del)",
        "Use Schema from @accountability/core for request/response types",
        "Define error types with HttpApiSchema.annotations for status codes",
        "Export API definition for use by server and client"
      ],
      "technical_details": {
        "pattern": "HttpApiGroup.make('accounts').add(endpoint).prefix('/api/v1')",
        "errors": "Schema.TaggedError with HttpApiSchema.annotations({ status: 404 })"
      },
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.1.5",
      "phase": "API Layer",
      "epic": "TanStack Start + Effect HttpApi Setup",
      "title": "Set up Effect Atom for frontend state",
      "description": "Configure Effect Atom for frontend state management, replacing TanStack Query patterns.",
      "specs": [
        "HTTP_API_TANSTACK.md"
      ],
      "acceptance_criteria": [
        "@effect-atom/atom-react installed",
        "AtomProvider configured in app root",
        "Atom runtime with HttpApiClient layer",
        "ApiClient atom for type-safe API calls",
        "Basic atoms demonstrating patterns: simple state, computed, async",
        "All tsconfig.src.json files have composite: true for project references"
      ],
      "technical_details": {
        "runtime": "Atom.runtime(Layer.mergeAll(FetchHttpClient.layer, ...))",
        "client": "HttpApiClient.make(AppApi) for type-safe calls",
        "tsconfig": "All tsconfig.src.json must have composite: true for incremental builds and proper project references"
      },
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.2.1",
      "phase": "API Layer",
      "epic": "HttpApi Endpoints",
      "title": "Implement accounts API endpoints",
      "description": "Create HttpApiGroup for accounts with CRUD endpoints and HttpApiBuilder handlers.",
      "specs": [
        "API_BEST_PRACTICES.md"
      ],
      "acceptance_criteria": [
        "AccountsApi group with endpoints: findById, list, create, update, delete",
        "HttpApiBuilder.group handlers calling AccountService",
        "Proper error responses: NotFoundError (404), ValidationError (422)",
        "Request validation via Schema",
        "Response serialization via Schema",
        "Tests for endpoint handlers"
      ],
      "technical_details": {
        "endpoint_pattern": "HttpApiEndpoint.get('findById')`/accounts/${accountIdParam}`",
        "handler_pattern": "HttpApiBuilder.group(AppApi, 'accounts', handlers => handlers.handle('findById', ...))"
      },
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.2.2",
      "phase": "API Layer",
      "epic": "HttpApi Endpoints",
      "title": "Refactor API schemas to use domain types directly",
      "description": "Update AccountsApi and AccountsApiLive to use domain schemas (AccountId, CompanyId, etc.) in path/URL params instead of Schema.String, eliminating manual decoding in handlers.",
      "specs": [
        "API_BEST_PRACTICES.md"
      ],
      "acceptance_criteria": [
        "Path params use domain schemas (AccountId instead of Schema.String)",
        "URL params use domain schemas (CompanyId, AccountType, etc.)",
        "No manual Schema.decodeUnknownEither calls in handlers",
        "HttpApi automatic validation handles all parsing",
        "Parse errors return 400 Bad Request automatically",
        "Handler code is simplified - receives already-decoded types",
        "All existing tests pass"
      ],
      "technical_details": {
        "before": ".setPath(Schema.Struct({ id: Schema.String })) // requires manual decode",
        "after": ".setPath(Schema.Struct({ id: AccountId })) // auto-decoded by HttpApi",
        "url_params": "Use CompanyId, AccountType, Schema.BooleanFromString, Schema.NumberFromString"
      },
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.2.3",
      "phase": "API Layer",
      "epic": "HttpApi Endpoints",
      "title": "Implement companies API endpoints",
      "description": "Create HttpApiGroup for companies with CRUD endpoints.",
      "acceptance_criteria": [
        "CompaniesApi group with endpoints: findById, list, create, update",
        "HttpApiBuilder.group handlers calling CompanyService",
        "Support for company settings (fiscal year, base currency)",
        "Proper error handling",
        "Tests for endpoint handlers"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.2.4",
      "phase": "API Layer",
      "epic": "HttpApi Endpoints",
      "title": "Implement journal entries API endpoints",
      "description": "Create HttpApiGroup for journal entries with full workflow endpoints.",
      "acceptance_criteria": [
        "JournalEntriesApi group with endpoints: findById, list, create, update, post, reverse",
        "HttpApiBuilder.group handlers calling JournalEntryService",
        "Filter support: companyId, periodRef, status, dateRange",
        "Pagination support in list endpoint",
        "Proper error handling for business rules (already posted, unbalanced)",
        "Tests for endpoint handlers"
      ],
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "6.2.5",
      "phase": "API Layer",
      "epic": "HttpApi Endpoints",
      "title": "Implement reports API endpoints",
      "description": "Create HttpApiGroup for financial report generation.",
      "acceptance_criteria": [
        "ReportsApi group with endpoints: trialBalance, balanceSheet, incomeStatement, cashFlow",
        "Report parameters: companyId, asOfDate, periodRef, comparative options",
        "HttpApiBuilder.group handlers calling report services",
        "Returns structured report data (headers, sections, line items, totals)",
        "Tests for report generation"
      ],
      "status": "complete",
      "estimated_complexity": "large"
    },
    {
      "id": "6.3.1",
      "phase": "API Layer",
      "epic": "API Infrastructure",
      "title": "Add authentication middleware",
      "description": "Implement HttpApiMiddleware for authentication using bearer tokens.",
      "acceptance_criteria": [
        "AuthMiddleware using HttpApiMiddleware.Tag",
        "Bearer token validation via HttpApiSecurity.bearer",
        "CurrentUser service provided to handlers",
        "UnauthorizedError (401) for invalid/missing tokens",
        "Apply middleware to protected API groups"
      ],
      "technical_details": {
        "pattern": "HttpApiMiddleware.Tag with security: { bearer: HttpApiSecurity.bearer }"
      },
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.3.2",
      "phase": "API Layer",
      "epic": "API Infrastructure",
      "title": "Add OpenAPI documentation",
      "description": "Enable automatic OpenAPI documentation generation.",
      "acceptance_criteria": [
        "HttpApiSwagger.layer at /docs for Swagger UI",
        "HttpApiBuilder.middlewareOpenApi at /openapi.json",
        "All endpoints documented with descriptions",
        "Request/response schemas visible in docs",
        "Error responses documented"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "6.3.3",
      "phase": "API Layer",
      "epic": "API Infrastructure",
      "title": "Set up API testing infrastructure",
      "description": "Configure HttpApi testing using @effect/vitest with it.layer pattern and NodeHttpServer.layerTest for in-memory testing without real HTTP server.",
      "acceptance_criteria": [
        "Test layer using NodeHttpServer.layerTest (no real server)",
        "HttpApiClient.make(AppApi) for type-safe test requests",
        "it.layer(HttpLive) pattern for shared test context",
        "Tests for success responses with proper Schema decoding",
        "Tests for error responses (404, 422, etc.)",
        "Tests for authentication middleware",
        "Example tests for each API group (accounts, companies, etc.)"
      ],
      "technical_details": {
        "layer_pattern": "HttpApiBuilder.serve().pipe(Layer.provide(ApiLive), Layer.provideMerge(NodeHttpServer.layerTest))",
        "test_pattern": "it.layer(HttpLive)('API Tests', (it) => { it.effect('test', () => ...) })",
        "client_pattern": "const client = yield* HttpApiClient.make(AppApi)",
        "error_testing": "Effect.flip to assert on expected errors"
      },
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.3.4",
      "phase": "API Layer",
      "epic": "API Infrastructure",
      "title": "Replace dummy API implementations with live services",
      "description": "Review all API handler implementations and replace any dummy/placeholder code with actual live service calls. Ensure AppApiLive properly composes all live layers.",
      "specs": [
        "API_BEST_PRACTICES.md"
      ],
      "acceptance_criteria": [
        "CRITICAL: NO MockRepositories - API MUST use real repository implementations only",
        "AppApiLive uses real repository and service layers, not stubs or mocks",
        "All API handlers call actual business logic services",
        "Remove any hardcoded/mock data from handlers",
        "Delete any Mock* repository files - they serve no purpose in the API",
        "Verify layer composition in AppApiLive provides all real dependencies",
        "All endpoints return real data from persistence layer (PostgreSQL)",
        "Error handling uses proper domain error types",
        "API handlers follow best practices (no manual Schema.decode for path/URL params)"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.4.1",
      "phase": "Persistence Layer",
      "epic": "Persistence Refinements",
      "title": "Complete missing persistence repositories",
      "description": "Review and complete any missing repository implementations in the persistence package. Ensure all domain entities have corresponding repositories with full CRUD operations.",
      "specs": [
        "ACCOUNTING_RESEARCH.md"
      ],
      "acceptance_criteria": [
        "All domain entities have repository interfaces defined",
        "All repository implementations are complete",
        "Repository methods follow consistent patterns",
        "Proper error types (EntityNotFoundError, PersistenceError) used",
        "All findBy* methods return Option for single results",
        "Batch operations available where appropriate"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.4.2",
      "phase": "Persistence Layer",
      "epic": "Persistence Refinements",
      "title": "Move service definitions to Services/ directory",
      "description": "Reorganize persistence package by moving service interface definitions (Context.Tag definitions) to a dedicated Services/ subdirectory for better code organization.",
      "acceptance_criteria": [
        "Create packages/persistence/src/Services/ directory",
        "Move all Context.Tag service definitions to Services/",
        "Each service in its own file (e.g., Services/AccountRepository.ts)",
        "Update all imports across the codebase",
        "Re-export services from persistence package index",
        "Ensure no circular dependencies"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "6.4.3",
      "phase": "Persistence Layer",
      "epic": "Persistence Refinements",
      "title": "Move service implementations to Layers/ directory",
      "description": "Reorganize persistence package by moving service implementations (Layer definitions) to a dedicated Layers/ subdirectory, separating interface from implementation.",
      "acceptance_criteria": [
        "Create packages/persistence/src/Layers/ directory",
        "Move all Layer implementations to Layers/",
        "Each implementation in its own file (e.g., Layers/AccountRepositoryLive.ts)",
        "Update all imports across the codebase",
        "Re-export layers from persistence package index",
        "Clear separation: Services/ has interfaces, Layers/ has implementations"
      ],
      "status": "complete",
      "estimated_complexity": "small"
    },
    {
      "id": "6.4.4",
      "phase": "Persistence Layer",
      "epic": "Persistence Refinements",
      "title": "Verify and complete database migrations",
      "description": "Review all database migrations to ensure they are complete and match the domain model requirements. Add any missing migrations for new features.",
      "specs": [
        "ACCOUNTING_RESEARCH.md"
      ],
      "acceptance_criteria": [
        "All domain entities have corresponding database tables",
        "All required columns are present with correct types",
        "Foreign key relationships properly defined",
        "Indexes added for common query patterns",
        "Migration files follow naming convention",
        "Migrations can run cleanly on fresh database"
      ],
      "status": "complete",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.4.5",
      "phase": "Persistence Layer",
      "epic": "Persistence Refinements",
      "title": "Add comprehensive repository tests",
      "description": "Ensure all repositories have comprehensive test coverage using the existing test infrastructure with real database connections.",
      "acceptance_criteria": [
        "All repository methods have unit tests",
        "Tests cover success and error paths",
        "Tests for CRUD operations on each entity",
        "Tests for findBy* queries with various filters",
        "Tests for edge cases (not found, duplicates, etc.)",
        "Tests use proper test fixtures and cleanup",
        "Test coverage above 80% for persistence package"
      ],
      "status": "in_progress",
      "estimated_complexity": "medium"
    },
    {
      "id": "6.4.6",
      "phase": "Core Domain",
      "epic": "Schema Improvements",
      "title": "Add LocalDateFromString schema to LocalDate module",
      "description": "Create a proper Schema for parsing ISO date strings directly to LocalDate, eliminating manual parseDate functions throughout the codebase.",
      "acceptance_criteria": [
        "LocalDateFromString schema in core/domain/LocalDate.ts",
        "Parses ISO date strings (YYYY-MM-DD) to LocalDate",
        "Proper error messages for invalid formats",
        "Replace parseDate utility functions with schema usage",
        "Update API handlers to use LocalDateFromString in URL params",
        "Update persistence layer to use schema for date columns"
      ],
      "technical_details": {
        "pattern": "Schema.transformOrFail from Schema.String to LocalDate with parsing logic"
      },
      "status": "pending",
      "estimated_complexity": "small"
    },
    {
      "id": "6.4.7",
      "phase": "API Layer",
      "epic": "API Refinements",
      "title": "Refactor API package to Definitions/ and Layers/ structure",
      "description": "Reorganize the API package to separate API definitions (schemas, endpoints, groups) from their implementations (handlers, layers).",
      "acceptance_criteria": [
        "Create packages/api/src/Definitions/ directory",
        "Move all HttpApiGroup definitions to Definitions/ (AccountsApi.ts, CompaniesApi.ts, etc.)",
        "Move AppApi.ts to Definitions/",
        "Create packages/api/src/Layers/ directory",
        "Move all HttpApiBuilder implementations to Layers/ (AccountsApiLive.ts, etc.)",
        "Move AppApiLive.ts to Layers/",
        "Update all imports across the codebase",
        "Clear separation: Definitions/ has API schemas, Layers/ has implementations"
      ],
      "status": "pending",
      "estimated_complexity": "small"
    },
    {
      "id": "6.4.8",
      "phase": "Codebase Cleanup",
      "epic": "Code Quality",
      "title": "Remove unnecessary re-exports across packages",
      "description": "Audit and remove unnecessary re-exports from package index files. Direct imports are preferred over barrel re-exports for better tree-shaking and clearer dependencies.",
      "acceptance_criteria": [
        "Audit all index.ts files in packages",
        "Remove re-exports that just forward from submodules",
        "Update imports to use direct paths instead of barrel imports",
        "Keep only essential public API exports in index files",
        "Verify no circular dependency issues after changes",
        "Ensure TypeScript project references still work correctly"
      ],
      "status": "pending",
      "estimated_complexity": "small"
    },
    {
      "id": "6.4.9",
      "phase": "API Layer",
      "epic": "API Completeness",
      "title": "Ensure API is feature complete with all persistence modules",
      "description": "Audit persistence repositories and ensure every domain entity has corresponding API endpoints. The API should expose all functionality that persistence supports.",
      "specs": [
        "API_BEST_PRACTICES.md",
        "ACCOUNTING_RESEARCH.md"
      ],
      "acceptance_criteria": [
        "Audit all repositories in persistence package",
        "Create API groups for any missing domain entities",
        "IntercompanyTransactionApi with full CRUD endpoints",
        "FiscalPeriodApi with full CRUD and period management endpoints",
        "CurrencyApi with exchange rate management endpoints",
        "All API groups follow consistent patterns (list, get, create, update, deactivate)",
        "All endpoints have proper OpenAPI documentation",
        "All endpoints use real repository implementations",
        "Feature parity: every persistence operation is accessible via API"
      ],
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "6.4.10",
      "phase": "Core Domain",
      "epic": "Code Organization",
      "title": "Rename core/domain and core/services to PascalCase",
      "description": "Rename directories in the core package to follow consistent PascalCase naming convention used across the codebase.",
      "acceptance_criteria": [
        "Rename packages/core/src/domain/ to packages/core/src/Domains/",
        "Rename packages/core/src/services/ to packages/core/src/Services/",
        "Update all imports across the entire codebase",
        "Update tsconfig paths if applicable",
        "Update package.json exports if applicable",
        "Verify TypeScript compilation passes",
        "Verify all tests pass after rename"
      ],
      "status": "pending",
      "estimated_complexity": "small"
    },
    {
      "id": "6.4.11",
      "phase": "Persistence Layer",
      "epic": "Schema Alignment",
      "title": "Fix ConsolidationRepository and Migration0009 schema mismatch",
      "description": "The ConsolidationRepositoryLive expects a different schema than what Migration0009_CreateConsolidationRuns actually creates. The repository uses JSONB columns while the migration creates normalized separate tables.",
      "specs": [
        "ACCOUNTING_RESEARCH.md"
      ],
      "acceptance_criteria": [
        "Decide on schema approach: normalized tables (Migration0009) vs denormalized JSONB (repository)",
        "If normalized: update ConsolidationRepositoryLive to query consolidation_run_steps table",
        "If normalized: update repository to query consolidated_trial_balances table",
        "If normalized: update repository to use consolidation_run_elimination_entries junction table",
        "Fix column name mismatches: group_idconsolidation_group_id, period_yearfiscal_year, period_numberfiscal_period",
        "If denormalized: update Migration0009 to use JSONB columns instead of separate tables",
        "Ensure all repository methods work correctly with the chosen schema",
        "Add/update tests to verify repository operations against actual database schema"
      ],
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "7.1.1",
      "phase": "UI Layer",
      "epic": "Core Components",
      "title": "Implement account selector component",
      "description": "Create reusable account selector/picker component with search and hierarchy display. Uses Effect Atom for async account loading.",
      "specs": [
        "HTTP_API_TANSTACK.md"
      ],
      "acceptance_criteria": [
        "Searchable dropdown with type-ahead filtering",
        "Shows account hierarchy with indentation",
        "Filters by account type if prop provided",
        "Keyboard navigation (arrow keys, enter, escape)",
        "Accessible: proper ARIA attributes",
        "Controlled component with value/onChange props",
        "Uses useAtomValue for accounts list from accountsAtom",
        "Search filtering via derived/computed atom"
      ],
      "technical_details": {
        "pattern": "Atom.derivedComputed for filtered/search results",
        "state": "Local React state for dropdown open/focused, Atom for accounts data"
      },
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "7.1.2",
      "phase": "UI Layer",
      "epic": "Core Components",
      "title": "Implement currency input component",
      "description": "Create currency input component with proper formatting and decimal handling. Currency list from Effect Atom.",
      "specs": [
        "HTTP_API_TANSTACK.md"
      ],
      "acceptance_criteria": [
        "Currency symbol display (prefix or suffix based on locale)",
        "Proper decimal formatting (2-4 places based on currency)",
        "Thousand separators",
        "Negative number support with proper display",
        "Optional currency code selector dropdown",
        "Controlled component returning BigDecimal-compatible string",
        "Currency list loaded via useAtomValue(currenciesAtom)",
        "Currency metadata (symbol, decimal places) from currencyAtom(code)"
      ],
      "technical_details": {
        "pattern": "Atom.family for per-currency metadata lookup",
        "state": "Local React state for input value, Atom for currency data"
      },
      "status": "pending",
      "estimated_complexity": "medium"
    },
    {
      "id": "7.2.1",
      "phase": "UI Layer",
      "epic": "Pages",
      "title": "Implement chart of accounts page",
      "description": "Create page for viewing and managing the chart of accounts using Effect Atom for state management.",
      "specs": [
        "HTTP_API_TANSTACK.md"
      ],
      "acceptance_criteria": [
        "Route: /companies/:companyId/accounts",
        "List all accounts in hierarchy (tree view)",
        "Add new account form (modal or slide-over)",
        "Edit account (inline or modal)",
        "Deactivate account (soft delete)",
        "Filter by account type via derived atom",
        "Uses accountsByCompanyAtom(companyId) for data",
        "Mutations via useAtomSet with mutationAtom pattern",
        "Optimistic updates for better UX"
      ],
      "technical_details": {
        "data_atom": "accountsByCompanyAtom = Atom.family((companyId) => asyncAtom fetching from API)",
        "mutations": "createAccountAtom, updateAccountAtom for create/edit operations",
        "ui_state": "Local React state for modal open, selected account, etc."
      },
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "7.2.2",
      "phase": "UI Layer",
      "epic": "Pages",
      "title": "Implement journal entry form",
      "description": "Create form for creating and editing journal entries with dynamic lines. Uses Effect Atom for state and mutations.",
      "specs": [
        "HTTP_API_TANSTACK.md"
      ],
      "acceptance_criteria": [
        "Route: /companies/:companyId/journal-entries/new and /edit/:id",
        "Add/remove lines dynamically",
        "Account selector component for each line",
        "Debit/credit currency inputs using CurrencyInput component",
        "Running balance display computed via derived atom",
        "Client-side validation via Schema (unbalanced, missing fields)",
        "Save as draft or submit for approval actions",
        "Form state managed via formAtom pattern",
        "Mutations via createJournalEntryAtom, updateJournalEntryAtom"
      ],
      "technical_details": {
        "form_state": "Local atom or React state for form fields and lines",
        "balance_atom": "Atom.derivedComputed calculating debits - credits in real-time",
        "validation": "Schema.decodeUnknown for client-side validation before submit",
        "mutations": "Mutation atoms with loading/error state handling"
      },
      "status": "pending",
      "estimated_complexity": "large"
    },
    {
      "id": "7.2.3",
      "phase": "UI Layer",
      "epic": "Pages",
      "title": "Implement report viewer page",
      "description": "Create page for viewing and exporting financial reports using Effect Atom for async report generation.",
      "specs": [
        "HTTP_API_TANSTACK.md"
      ],
      "acceptance_criteria": [
        "Route: /companies/:companyId/reports",
        "Report type selector: Trial Balance, Balance Sheet, Income Statement, Cash Flow",
        "Date/period parameter inputs stored in local state",
        "Report data fetched via reportAtom(type, params)",
        "Report display with proper formatting (indentation, subtotals, totals)",
        "Drill-down to transactions using transactionsAtom(accountId, dateRange)",
        "Loading and error states via Atom status",
        "Export to PDF/Excel (can be future enhancement)"
      ],
      "technical_details": {
        "report_atom": "Atom.family((params) => asyncAtom calling reports API)",
        "params_pattern": "Local React state for report type, dates - atom key changes trigger refetch",
        "drill_down": "On account click, set selectedAccount state, show transactionsAtom data"
      },
      "status": "pending",
      "estimated_complexity": "large"
    }
  ]
}
